<!DOCTYPE html>
<html>
  <head>
     
    <meta charset="UTF-8">
    <title>爬虫学习(1) - 超基础篇 - Mai Icy</title>
    <link rel="shortcut icon" href="/static/img/icon.png">
    <link rel="icon" href="/static/img/icon.png" sizes="192x192"/>
    
<link rel="stylesheet" href="/static/kico.css">
<link rel="stylesheet" href="/static/hingle.css">

    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome/css/font-awesome.min.css">

    <meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1"/>
    <meta property="og:site_name" content="Mai Icy">
    <meta property="og:title" content="爬虫学习(1) - 超基础篇"/>
    
<meta name="generator" content="Hexo 6.0.0"></head>

  <body>
    <header>
    <div class="head-title">
        <h4>Mai Icy</h4>
    </div>
    <div class="head-action">
        <div class="toggle-btn"></div>
        <div class="light-btn"></div>
        <div class="search-btn"></div>
    </div>
    <form class="head-search" method="post">
        <input type="text" name="s" placeholder="搜索什么？">
    </form>
    <nav class="head-menu">
        <a href="/">首页</a>
        <div class="has-child">
            <a>分类</a>
            <div class="sub-menu">
                
            </div>
        </div>
        
            <a href="/about">关于我</a>
        
            <a href="/friends">朋友们</a>
        
    </nav>
</header>

    <main>
    <div class="wrap min">
        <section class="post-title">
            <h2>爬虫学习(1) - 超基础篇</h2>
            <div class="post-meta">
                <time class="date">2022.03.10</time>
            
            </div>
        </section>
        <article class="post-content">
        
            <p>网络爬虫（又称为网页蜘蛛，网络机器人，在FOAF社区中间，更经常的称为网页追逐者），是一种按照一定的规则，自动地抓取万维网信息的程序或者脚本。另外一些不常使用的名字还有蚂蚁、自动索引、模拟程序或者蠕虫。</p>
<p>虽然听起来十分高级，但是说清楚了，网络爬虫就是在机器代替人的时代下，让机器代替人上网，从网上获取信息，让程序服务人来获取网上数据，网上操作，这就是网络爬虫。</p>
<p>做一个网络爬虫，我们要先了解http协议和tcp协议，</p>
<h1 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h1><h3 id="HTTP简介"><a href="#HTTP简介" class="headerlink" title="HTTP简介"></a>HTTP简介</h3><p>HTTP协议是Hyper Text Transfer Protocol（超文本传输协议）的缩写,是用于从万维网（WWW:World Wide Web ）服务器传输超文本到本地浏览器的传送协议。</p>
<p>HTTP是一个基于TCP&#x2F;IP通信协议来传递数据（HTML 文件, 图片文件, 查询结果等）。</p>
<p>在如此抽象的概念之下我们需要一些基础的理解，后端，前端，浏览器，用户之间的关系。</p>
<p>简单说，就是用户利用浏览器。浏览器作为用户和网站交流的中介，他可以理解服务器返回的数据，并对其加以处理</p>
<p>举一个例子(这是一个返回的html文件)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>我的第一个 HTML 页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>body 元素的内容会显示在浏览器中。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>title 元素的内容会显示在浏览器的标题栏中。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在浏览器的处理下，会变为</p>
<img src="/2022/03/10/crawler-1/p1.png" class="" title="This is an example image">

<p>这就是用户通过浏览器看到的页面</p>
<p>他的内部可以置入许多按钮和输入框，这样的话，用户可以根据需要，就比如登录，就要通过输入账号密码</p>
<p>这个时候，用户就是在前端进行操作（前端就是指上面返回的页面，高级的前端会有很多脚本，可以供用户提交表单）</p>
<p>前端提交的数据交给后端，后端对提交的数据包进行处理，忽略和排除非法的包（</p>
<p>后端会再次返回数据交给前端</p>
<p>前端再次分析显示数据，用户看到的画面就会变化</p>
<p>在这个过程中，如果我们要做网络爬虫，我们就要从对后端发送数据包开始</p>
<p>这个时候我们要通过”抓包”操作，对前端发送的数据包进行分析，了解发送的数据包的规律和参数分布</p>
<p>模仿用户对前端的操作，发送数据包给后端，从后端返回的数据里面，找到自己需要的进行过滤</p>
<h3 id="HTTP消息结构"><a href="#HTTP消息结构" class="headerlink" title="HTTP消息结构"></a>HTTP消息结构</h3><p>以下是一个header</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User-Agent: curl/7.16.3 libcurl/7.16.3 OpenSSL/0.9.7l zlib/1.2.3</span><br><span class="line">Host: www.example.com</span><br><span class="line">Accept-Language: en, mi</span><br></pre></td></tr></table></figure>

<p>这只是一些基础的参数</p>
<p>但对于post，我们是要传参的，会比上面那个多几个参数（部分get也会有），例如</p>
<table>
<thead>
<tr>
<th align="center"><strong>Header</strong>参数</th>
<th align="center">分类描述</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Authorization</td>
<td align="center">信息，服务器收到请求，需要请求者继续执行操作</td>
<td>Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ&#x3D;&#x3D;</td>
</tr>
<tr>
<td align="center">Referer</td>
<td align="center">先前网页的地址，当前请求网页紧随其后,即来路</td>
<td>Referer: <a target="_blank" rel="noopener" href="https://www.baidu.com/">https://www.baidu.com/</a></td>
</tr>
<tr>
<td align="center">Content-Length</td>
<td align="center">请求的内容长度</td>
<td>Content-Length: 233</td>
</tr>
<tr>
<td align="center">Content-Type</td>
<td align="center">请求的与实体对应的MIME信息</td>
<td>Content-Type: application&#x2F;x-www-form-urlencoded</td>
</tr>
<tr>
<td align="center">Host</td>
<td align="center">指定请求的服务器的域名和端口号</td>
<td>Host: <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a></td>
</tr>
<tr>
<td align="center">Cookie</td>
<td align="center">HTTP请求发送时，会把保存在该请求域名下的所有cookie值一起发送给web服务器。</td>
<td>Cookie: $Version&#x3D;1; Skin&#x3D;new;</td>
</tr>
</tbody></table>
<p>HTTP 协议中共定义了八种方法或者叫“动作”来表明对 Request-URI 指定的资源的不同操作方式，具体介绍如下：</p>
<ul>
<li><strong>OPTIONS</strong>：返回服务器针对特定资源所支持的HTTP请求方法。也可以利用向Web服务器发送’*’的请求来测试服务器的功能性。</li>
<li><strong>HEAD</strong>：向服务器索要与GET请求相一致的响应，只不过响应体将不会被返回。这一方法可以在不必传输整个响应内容的情况下，就可以获取包含在响应消息头中的元信息。</li>
<li><strong>GET</strong>：向特定的资源发出请求。</li>
<li><strong>POST</strong>：向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST请求可能会导致新的资源的创建和&#x2F;或已有资源的修改。</li>
<li><strong>PUT</strong>：向指定资源位置上传其最新内容。</li>
<li><strong>DELETE</strong>：请求服务器删除 Request-URI 所标识的资源。</li>
<li><strong>TRACE</strong>：回显服务器收到的请求，主要用于测试或诊断。</li>
<li><strong>CONNECT</strong>：HTTP&#x2F;1.1 协议中预留给能够将连接改为管道方式的代理服务器。</li>
</ul>
<p>虽然 HTTP 的请求方式有 8 种，但是我们在实际应用中常用的也就是 <strong>get</strong> 和 <strong>post</strong>，其他请求方式也都可以通过这两种方式间接的来实现。</p>
<p>但至于我们只要做低级爬虫<br>只要了解这两个就已经足够了</p>
<ul>
<li><strong>GET</strong>：请求指定的页面信息，并返回实体主体。</li>
<li><strong>POST</strong>：向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST请求可能会导致新的资源的创建和&#x2F;或已有资源的修改。</li>
</ul>
<h2 id="HTTP状态码分类"><a href="#HTTP状态码分类" class="headerlink" title="HTTP状态码分类"></a>HTTP状态码分类</h2><p>HTTP状态码由三个十进制数字组成，第一个十进制数字定义了状态码的类型，后两个数字没有分类的作用。HTTP状态码共分为5种类型：</p>
<p>HTTP状态码分类</p>
<table>
<thead>
<tr>
<th align="center">分类</th>
<th align="center">分类描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1**</td>
<td align="center">信息，服务器收到请求，需要请求者继续执行操作</td>
</tr>
<tr>
<td align="center">2**</td>
<td align="center">成功，操作被成功接收并处理</td>
</tr>
<tr>
<td align="center">3**</td>
<td align="center">重定向，需要进一步的操作以完成请求</td>
</tr>
<tr>
<td align="center">4**</td>
<td align="center">客户端错误，请求包含语法错误或无法完成请求</td>
</tr>
<tr>
<td align="center">5**</td>
<td align="center">服务器错误，服务器在处理请求的过程中发生了错误</td>
</tr>
</tbody></table>
<h2 id="HTTP状态码列表"><a href="#HTTP状态码列表" class="headerlink" title="HTTP状态码列表:"></a>HTTP状态码列表:</h2><table>
<thead>
<tr>
<th align="center">状态码</th>
<th align="right">状态码英文名称</th>
<th align="left">中文描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">100</td>
<td align="right">Continue</td>
<td align="left">继续。客户端应继续其请求</td>
</tr>
<tr>
<td align="center">101</td>
<td align="right">Switching Protocols</td>
<td align="left">切换协议。服务器根据客户端的请求切换协议。只能切换到更高级的协议，例如，切换到HTTP的新版本协议</td>
</tr>
<tr>
<td align="center">200</td>
<td align="right">OK</td>
<td align="left">请求成功。一般用于GET与POST请求</td>
</tr>
<tr>
<td align="center">201</td>
<td align="right">Created</td>
<td align="left">已创建。成功请求并创建了新的资源</td>
</tr>
<tr>
<td align="center">202</td>
<td align="right">Accepted</td>
<td align="left">已接受。已经接受请求，但未处理完成</td>
</tr>
<tr>
<td align="center">203</td>
<td align="right">Non-Authoritative Information</td>
<td align="left">非授权信息。请求成功。但返回的meta信息不在原始的服务器，而是一个副本</td>
</tr>
<tr>
<td align="center">204</td>
<td align="right">No Content</td>
<td align="left">无内容。服务器成功处理，但未返回内容。在未更新网页的情况下，可确保浏览器继续显示当前文档</td>
</tr>
<tr>
<td align="center">205</td>
<td align="right">Reset Content</td>
<td align="left">重置内容。服务器处理成功，用户终端（例如：浏览器）应重置文档视图。可通过此返回码清除浏览器的表单域</td>
</tr>
<tr>
<td align="center">206</td>
<td align="right">Partial Content</td>
<td align="left">部分内容。服务器成功处理了部分GET请求</td>
</tr>
<tr>
<td align="center">300</td>
<td align="right">Multiple Choices</td>
<td align="left">多种选择。请求的资源可包括多个位置，相应可返回一个资源特征与地址的列表用于用户终端（例如：浏览器）选择</td>
</tr>
<tr>
<td align="center">301</td>
<td align="right">Moved Permanently</td>
<td align="left">永久移动。请求的资源已被永久的移动到新URI，返回信息会包括新的URI，浏览器会自动定向到新URI。今后任何新的请求都应使用新的URI代替</td>
</tr>
<tr>
<td align="center">302</td>
<td align="right">Found</td>
<td align="left">临时移动。与301类似。但资源只是临时被移动。客户端应继续使用原有URI</td>
</tr>
<tr>
<td align="center">303</td>
<td align="right">See Other</td>
<td align="left">查看其它地址。与301类似。使用GET和POST请求查看</td>
</tr>
<tr>
<td align="center">304</td>
<td align="right">Not Modified</td>
<td align="left">未修改。所请求的资源未修改，服务器返回此状态码时，不会返回任何资源。客户端通常会缓存访问过的资源，通过提供一个头信息指出客户端希望只返回在指定日期之后修改的资源</td>
</tr>
<tr>
<td align="center">305</td>
<td align="right">Use Proxy</td>
<td align="left">使用代理。所请求的资源必须通过代理访问</td>
</tr>
<tr>
<td align="center">306</td>
<td align="right">Unused</td>
<td align="left">已经被废弃的HTTP状态码</td>
</tr>
<tr>
<td align="center">307</td>
<td align="right">Temporary Redirect</td>
<td align="left">临时重定向。与302类似。使用GET请求重定向</td>
</tr>
<tr>
<td align="center">400</td>
<td align="right">Bad Request</td>
<td align="left">客户端请求的语法错误，服务器无法理解</td>
</tr>
<tr>
<td align="center">401</td>
<td align="right">Unauthorized</td>
<td align="left">请求要求用户的身份认证</td>
</tr>
<tr>
<td align="center">402</td>
<td align="right">Payment Required</td>
<td align="left">保留，将来使用</td>
</tr>
<tr>
<td align="center">403</td>
<td align="right">Forbidden</td>
<td align="left">服务器理解请求客户端的请求，但是拒绝执行此请求</td>
</tr>
<tr>
<td align="center">404</td>
<td align="right">Not Found</td>
<td align="left">服务器无法根据客户端的请求找到资源（网页）。通过此代码，网站设计人员可设置”您所请求的资源无法找到”的个性页面</td>
</tr>
<tr>
<td align="center">405</td>
<td align="right">Method Not Allowed</td>
<td align="left">客户端请求中的方法被禁止</td>
</tr>
<tr>
<td align="center">406</td>
<td align="right">Not Acceptable</td>
<td align="left">服务器无法根据客户端请求的内容特性完成请求</td>
</tr>
<tr>
<td align="center">407</td>
<td align="right">Proxy Authentication Required</td>
<td align="left">请求要求代理的身份认证，与401类似，但请求者应当使用代理进行授权</td>
</tr>
<tr>
<td align="center">408</td>
<td align="right">Request Time-out</td>
<td align="left">服务器等待客户端发送的请求时间过长，超时</td>
</tr>
<tr>
<td align="center">409</td>
<td align="right">Conflict</td>
<td align="left">服务器完成客户端的 PUT 请求时可能返回此代码，服务器处理请求时发生了冲突</td>
</tr>
<tr>
<td align="center">410</td>
<td align="right">Gone</td>
<td align="left">客户端请求的资源已经不存在。410不同于404，如果资源以前有现在被永久删除了可使用410代码，网站设计人员可通过301代码指定资源的新位置</td>
</tr>
<tr>
<td align="center">411</td>
<td align="right">Length Required</td>
<td align="left">服务器无法处理客户端发送的不带Content-Length的请求信息</td>
</tr>
<tr>
<td align="center">412</td>
<td align="right">Precondition Failed</td>
<td align="left">客户端请求信息的先决条件错误</td>
</tr>
<tr>
<td align="center">413</td>
<td align="right">Request Entity Too Large</td>
<td align="left">由于请求的实体过大，服务器无法处理，因此拒绝请求。为防止客户端的连续请求，服务器可能会关闭连接。如果只是服务器暂时无法处理，则会包含一个Retry-After的响应信息</td>
</tr>
<tr>
<td align="center">414</td>
<td align="right">Request-URI Too Large</td>
<td align="left">请求的URI过长（URI通常为网址），服务器无法处理</td>
</tr>
<tr>
<td align="center">415</td>
<td align="right">Unsupported Media Type</td>
<td align="left">服务器无法处理请求附带的媒体格式</td>
</tr>
<tr>
<td align="center">416</td>
<td align="right">Requested range not satisfiable</td>
<td align="left">客户端请求的范围无效</td>
</tr>
<tr>
<td align="center">417</td>
<td align="right">Expectation Failed</td>
<td align="left">服务器无法满足Expect的请求头信息</td>
</tr>
<tr>
<td align="center">500</td>
<td align="right">Internal Server Error</td>
<td align="left">服务器内部错误，无法完成请求</td>
</tr>
<tr>
<td align="center">501</td>
<td align="right">Not Implemented</td>
<td align="left">服务器不支持请求的功能，无法完成请求</td>
</tr>
<tr>
<td align="center">502</td>
<td align="right">Bad Gateway</td>
<td align="left">作为网关或者代理工作的服务器尝试执行请求时，从远程服务器接收到了一个无效的响应</td>
</tr>
<tr>
<td align="center">503</td>
<td align="right">Service Unavailable</td>
<td align="left">由于超载或系统维护，服务器暂时的无法处理客户端的请求。延时的长度可包含在服务器的Retry-After头信息中</td>
</tr>
<tr>
<td align="center">504</td>
<td align="right">Gateway Time-out</td>
<td align="left">充当网关或代理的服务器，未及时从远端服务器获取请求</td>
</tr>
<tr>
<td align="center">505</td>
<td align="right">HTTP Version not supported</td>
<td align="left">服务器不支持请求的HTTP协议的版本，无法完成处理</td>
</tr>
</tbody></table>
<h1 id="爬虫教程"><a href="#爬虫教程" class="headerlink" title="爬虫教程"></a>爬虫教程</h1><p>我们以一个简单的网站作为例子，</p>
<p>先从简单的做起</p>
<h2 id="一-中华万年历"><a href="#一-中华万年历" class="headerlink" title="一. 中华万年历"></a>一. 中华万年历</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>中华万年历—让时光充满乐趣，<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%97%A5%E5%8E%86/84469">日历</a>类TOP 1应用。基于传统黄历、日程记录等日历功能上提供个性化阅读服务、生活提醒服务等，致力于成为用户的智能生活提醒助手 。</p>
<img src="/2022/03/10/crawler-1/p2.png" class="">



<p>那我们可以从它这里获取什么呢？</p>
<p>天气是中华万年历可以提供的，所以我们的目标是获取天气，这样子的话，我们就可以不用天天跑网站上看天气了（好像也没什么很大必要，由于是练习，就依我这么说罢）</p>
<p>我们要先找到获取天气的地方，进行‘抓包’</p>
<p>抓包工具有许多，像fiddler，Charles，还有许多浏览器自带的开发者模式（例如谷歌的F12）等等</p>
<p>对于我们来说，浏览器的代理就够用了，不过我这里依然拿Charles做示例，软件的使用方式请自行查询</p>
<img src="/2022/03/10/crawler-1/p3.png" class="" title="中华万年历示例">



<p>找到这个页面之后，我们发现，它可以显示出天气，说明后端在前端的请求中返回了关于天气的数据</p>
<p>此时利用抓包工具我们能发现这些数据</p>
<img src="/2022/03/10/crawler-1/p4.png" class="" title="抓包示例">

<p>这里我们发现了一个问题，就是返回的数据不能正常显示，其实就是被加密了。我们可以在accept-encoding中发现gzip，代表了后端返回的数据是经过gzip加密的，不过问题不大，如果感兴趣的话，可以自行查询和研究，python的requests库内的请求是会自动根据返回值进行解码的</p>
<p>不过这里就先跳过了，</p>
<p>再来观察参数，我们是get方式获取数据的，所以参数都在url（网址之中）我们来观察网址后缀</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/weather_mini?city=%E5%8D%97%E4%BA%AC&amp;callback=flightHandler&amp;callback=flightHandler&amp;_=1622798035220</span><br><span class="line"></span><br><span class="line">问号之后就是我们需要观察的参数</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>（你可以想象一下我写了5000多字文章没保存现在只有3500留下来的感受）</p>
<p>（插播：请大家随时按ctrl+s）</p>
<p>这里我们发现一段尤其显眼的东西“%E5%8D%97%E4%BA%AC”这里其实是中文的url编码，大致意思就是中文在网址里面的编码，通过url解码，我们可以得到结果“南京”所以在city参数后面的值就是“南京”。</p>
<p>所以我们可以大胆猜测一下网址就是查询的方式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://wthrcdn.etouch.cn/weather_mini?city=北京</span><br><span class="line">http://wthrcdn.etouch.cn/weather_mini?city=温州</span><br><span class="line">http://wthrcdn.etouch.cn/weather_mini?city=曹县</span><br></pre></td></tr></table></figure>

<p>选择一个用python的requests库进行获取</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">a = requests.get(<span class="string">&#x27;http://wthrcdn.etouch.cn/weather_mini?city=乐清&#x27;</span>)</span><br><span class="line">res_json = json.loads(a.text)</span><br><span class="line"><span class="built_in">print</span>(res_json)</span><br></pre></td></tr></table></figure>

<p>输出结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;data&#x27;: &#123;&#x27;yesterday&#x27;: &#123;&#x27;date&#x27;: &#x27;20日星期日&#x27;, &#x27;high&#x27;: &#x27;高温 25℃&#x27;, &#x27;fx&#x27;: &#x27;东北风&#x27;, &#x27;low&#x27;: &#x27;低温 22℃&#x27;, &#x27;fl&#x27;: &#x27;&lt;![CDATA[2级]]&gt;&#x27;, &#x27;type&#x27;: &#x27;中雨&#x27;&#125;, &#x27;city&#x27;: &#x27;乐清&#x27;, &#x27;forecast&#x27;: [&#123;&#x27;date&#x27;: &#x27;21日星期一&#x27;, &#x27;high&#x27;: &#x27;高温 25℃&#x27;, &#x27;fengli&#x27;: &#x27;&lt;![CDATA[2级]]&gt;&#x27;, &#x27;low&#x27;: &#x27;低温 20℃&#x27;, &#x27;fengxiang&#x27;: &#x27;东北风&#x27;, &#x27;type&#x27;: &#x27;小雨&#x27;&#125;, &#123;&#x27;date&#x27;: &#x27;22日星期二&#x27;, &#x27;high&#x27;: &#x27;高温 28℃&#x27;, &#x27;fengli&#x27;: &#x27;&lt;![CDATA[2级]]&gt;&#x27;, &#x27;low&#x27;: &#x27;低温 22℃&#x27;, &#x27;fengxiang&#x27;: &#x27;北风&#x27;, &#x27;type&#x27;: &#x27;小雨&#x27;&#125;, &#123;&#x27;date&#x27;: &#x27;23日星期三&#x27;, &#x27;high&#x27;: &#x27;高温 27℃&#x27;, &#x27;fengli&#x27;: &#x27;&lt;![CDATA[2级]]&gt;&#x27;, &#x27;low&#x27;: &#x27;低温 23℃&#x27;, &#x27;fengxiang&#x27;: &#x27;东北风&#x27;, &#x27;type&#x27;: &#x27;多云&#x27;&#125;, &#123;&#x27;date&#x27;: &#x27;24日星期四&#x27;, &#x27;high&#x27;: &#x27;高温 27℃&#x27;, &#x27;fengli&#x27;: &#x27;&lt;![CDATA[1级]]&gt;&#x27;, &#x27;low&#x27;: &#x27;低温 22℃&#x27;, &#x27;fengxiang&#x27;: &#x27;东风&#x27;, &#x27;type&#x27;: &#x27;多云&#x27;&#125;, &#123;&#x27;date&#x27;: &#x27;25日星期五&#x27;, &#x27;high&#x27;: &#x27;高温 27℃&#x27;, &#x27;fengli&#x27;: &#x27;&lt;![CDATA[1级]]&gt;&#x27;, &#x27;low&#x27;: &#x27;低温 24℃&#x27;, &#x27;fengxiang&#x27;: &#x27;东南风&#x27;, &#x27;type&#x27;: &#x27;小雨&#x27;&#125;], &#x27;ganmao&#x27;: &#x27;感冒低发期，天气舒适，请注意多吃蔬菜水果，多喝水哦。&#x27;, &#x27;wendu&#x27;: &#x27;23&#x27;&#125;, &#x27;status&#x27;: 1000, &#x27;desc&#x27;: &#x27;OK&#x27;&#125;</span><br></pre></td></tr></table></figure>

<p>数据看起来杂乱无章，实际条理很有序，经过json格式化</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;yesterday&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;20日星期日&quot;</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="attr">&quot;high&quot;</span><span class="punctuation">:</span> <span class="string">&quot;高温 25℃&quot;</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="attr">&quot;fx&quot;</span><span class="punctuation">:</span> <span class="string">&quot;东北风&quot;</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="attr">&quot;low&quot;</span><span class="punctuation">:</span> <span class="string">&quot;低温 22℃&quot;</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="attr">&quot;fl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;![CDATA[2级]]&gt;&quot;</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;中雨&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">        <span class="attr">&quot;city&quot;</span><span class="punctuation">:</span> <span class="string">&quot;乐清&quot;</span><span class="punctuation">,</span> </span><br><span class="line">        <span class="attr">&quot;forecast&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;21日星期一&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;high&quot;</span><span class="punctuation">:</span> <span class="string">&quot;高温 25℃&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;fengli&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;![CDATA[2级]]&gt;&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;low&quot;</span><span class="punctuation">:</span> <span class="string">&quot;低温 20℃&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;fengxiang&quot;</span><span class="punctuation">:</span> <span class="string">&quot;东北风&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;小雨&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;22日星期二&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;high&quot;</span><span class="punctuation">:</span> <span class="string">&quot;高温 28℃&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;fengli&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;![CDATA[2级]]&gt;&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;low&quot;</span><span class="punctuation">:</span> <span class="string">&quot;低温 22℃&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;fengxiang&quot;</span><span class="punctuation">:</span> <span class="string">&quot;北风&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;小雨&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;23日星期三&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;high&quot;</span><span class="punctuation">:</span> <span class="string">&quot;高温 27℃&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;fengli&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;![CDATA[2级]]&gt;&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;low&quot;</span><span class="punctuation">:</span> <span class="string">&quot;低温 23℃&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;fengxiang&quot;</span><span class="punctuation">:</span> <span class="string">&quot;东北风&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;多云&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;24日星期四&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;high&quot;</span><span class="punctuation">:</span> <span class="string">&quot;高温 27℃&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;fengli&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;![CDATA[1级]]&gt;&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;low&quot;</span><span class="punctuation">:</span> <span class="string">&quot;低温 22℃&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;fengxiang&quot;</span><span class="punctuation">:</span> <span class="string">&quot;东风&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;多云&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;25日星期五&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;high&quot;</span><span class="punctuation">:</span> <span class="string">&quot;高温 27℃&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;fengli&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;![CDATA[1级]]&gt;&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;low&quot;</span><span class="punctuation">:</span> <span class="string">&quot;低温 24℃&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;fengxiang&quot;</span><span class="punctuation">:</span> <span class="string">&quot;东南风&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;小雨&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span> </span><br><span class="line">        <span class="attr">&quot;ganmao&quot;</span><span class="punctuation">:</span> <span class="string">&quot;感冒低发期，天气舒适，请注意多吃蔬菜水果，多喝水哦。&quot;</span><span class="punctuation">,</span> </span><br><span class="line">        <span class="attr">&quot;wendu&quot;</span><span class="punctuation">:</span> <span class="string">&quot;23&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">1000</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OK&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>结果嵌套分明，我们可以通过res_json &#x3D; json.loads(a.text)来把获取到的数据转换成dict，以便我们进行访问，经过数据处理，我们可以轻松获取其中的数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(res_json[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;yesterday&#x27;</span>][<span class="string">&#x27;date&#x27;</span>])  <span class="comment"># &#x27;20日星期日&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(res_json[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;city&#x27;</span>])  <span class="comment"># &#x27;乐清&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(res_json[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;forecast&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;date&#x27;</span>])  <span class="comment"># &#x27;21日星期一&#x27;</span></span><br></pre></td></tr></table></figure>

<p>我们成功的完成了我们的爬虫任务，那现在可以做什么呢？，这里给出示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeatherApi</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.url = <span class="string">&#x27;http://wthrcdn.etouch.cn/weather_mini?city=&#x27;</span></span><br><span class="line">        self.ttf_path = <span class="string">&#x27;..\\Requirement\\font\\simhei.ttf&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_weather</span>(<span class="params">self, location</span>):</span><br><span class="line">        request_url = self.url + <span class="built_in">str</span>(location)</span><br><span class="line">        back_data = requests.get(request_url)</span><br><span class="line">        json_weather = json.loads(back_data.text)</span><br><span class="line">        <span class="keyword">return</span> json_weather[<span class="string">&#x27;data&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_data</span>(<span class="params">self</span>):</span><br><span class="line">        json_weather = self.get_weather(<span class="string">&#x27;上海&#x27;</span>)[<span class="string">&#x27;data&#x27;</span>]</span><br><span class="line">        tips = json_weather[<span class="string">&#x27;ganmao&#x27;</span>]</span><br><span class="line">        temperature_now = json_weather[<span class="string">&#x27;wendu&#x27;</span>]</span><br><span class="line">        weather_forecast = json_weather[<span class="string">&#x27;forecast&#x27;</span>]</span><br><span class="line">        <span class="comment"># m = re.findall(&quot;\d+&quot;, weather_forecast[1][&#x27;high&#x27;])[0]</span></span><br><span class="line">        <span class="keyword">return</span> tips, temperature_now, weather_forecast</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">img_crate</span>(<span class="params">self, json_weather</span>):</span><br><span class="line">        column = <span class="number">1</span></span><br><span class="line">        back_ground = Image.<span class="built_in">open</span>(<span class="string">&#x27;..\\Requirement\\background\\weather\\dark.png&#x27;</span>)</span><br><span class="line">        data_today = json_weather[<span class="string">&quot;forecast&quot;</span>][<span class="number">0</span>]</span><br><span class="line">        day_type = data_today[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> day_type == <span class="string">&#x27;晴&#x27;</span> <span class="keyword">or</span> day_type == <span class="string">&#x27;多云&#x27;</span>:</span><br><span class="line">            back_ground = Image.<span class="built_in">open</span>(<span class="string">&#x27;..\\Requirement\\background\\weather\\bright.png&#x27;</span>)</span><br><span class="line">        month = datetime.datetime.now().month</span><br><span class="line">        img_draw = ImageDraw.Draw(back_ground)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">            data = json_weather[<span class="string">&quot;forecast&quot;</span>][i]</span><br><span class="line">            week = <span class="string">&#x27;周&#x27;</span> + data[<span class="string">&#x27;date&#x27;</span>][-<span class="number">1</span>]</span><br><span class="line">            date = re.findall(<span class="string">r&#x27;\d+日&#x27;</span>, data[<span class="string">&#x27;date&#x27;</span>])[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(re.findall(<span class="string">r&#x27;\d+&#x27;</span>, data[<span class="string">&#x27;date&#x27;</span>])[<span class="number">0</span>]) == <span class="number">1</span>:</span><br><span class="line">                month = month + <span class="number">1</span></span><br><span class="line">            date = <span class="built_in">str</span>(month) + <span class="string">&#x27;月&#x27;</span> + date</span><br><span class="line">            day_type = data[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">            high = re.findall(<span class="string">r&#x27;\d+℃&#x27;</span>, data[<span class="string">&#x27;high&#x27;</span>])[<span class="number">0</span>]</span><br><span class="line">            low = <span class="built_in">int</span>(re.findall(<span class="string">r&#x27;\d+&#x27;</span>, data[<span class="string">&#x27;low&#x27;</span>])[<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">if</span> low &lt; <span class="number">10</span>:</span><br><span class="line">                low = <span class="string">&#x27; &#x27;</span>+<span class="built_in">str</span>(low)</span><br><span class="line">            temperature = <span class="built_in">str</span>(low) + <span class="string">&#x27;-&#x27;</span> + high</span><br><span class="line">            day_text = data[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">            <span class="keyword">if</span> day_type == <span class="string">&#x27;阴&#x27;</span> <span class="keyword">or</span> day_type == <span class="string">&#x27;晴&#x27;</span>:</span><br><span class="line">                day_type = <span class="string">&#x27; &#x27;</span> + day_type</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                day_img = Image.<span class="built_in">open</span>(<span class="string">&#x27;..\\Requirement\\img\\small_weather_img\\&#x27;</span> + day_text + <span class="string">&#x27;.png&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">                day_img = Image.<span class="built_in">open</span>(<span class="string">&#x27;..\\Requirement\\img\\small_weather_img\\NA.png&#x27;</span>)</span><br><span class="line">            back_ground.paste(day_img, (<span class="number">47</span> + <span class="number">52</span> * column, <span class="number">57</span>), day_img)</span><br><span class="line">            ttf = ImageFont.truetype(self.ttf_path, <span class="number">10</span>)</span><br><span class="line">            img_draw.text((<span class="number">49</span> + <span class="number">52</span> * column, <span class="number">94</span>), temperature, font=ttf, fill=(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line">            img_draw.text((<span class="number">49</span> + <span class="number">52</span> * column, <span class="number">45</span>), date, font=ttf, fill=(<span class="number">183</span>, <span class="number">183</span>, <span class="number">183</span>))</span><br><span class="line">            ttf = ImageFont.truetype(self.ttf_path, <span class="number">15</span>)</span><br><span class="line">            img_draw.text((<span class="number">50</span> + <span class="number">52</span> * column, <span class="number">106</span>), day_type, font=ttf, fill=(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line">            ttf = ImageFont.truetype(self.ttf_path, <span class="number">16</span>)</span><br><span class="line">            img_draw.text((<span class="number">51</span> + <span class="number">52</span> * column, <span class="number">29</span>), week, font=ttf, fill=(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line">            column = column + <span class="number">1</span></span><br><span class="line">        day_type = data_today[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">        high = re.findall(<span class="string">r&#x27;\d+℃&#x27;</span>, data_today[<span class="string">&#x27;high&#x27;</span>])[<span class="number">0</span>]</span><br><span class="line">        low = <span class="built_in">int</span>(re.findall(<span class="string">r&#x27;\d+&#x27;</span>, data_today[<span class="string">&#x27;low&#x27;</span>])[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> low &lt; <span class="number">10</span>:</span><br><span class="line">            low = <span class="string">&#x27; &#x27;</span> + <span class="built_in">str</span>(low)</span><br><span class="line">        temperature = <span class="built_in">str</span>(low) + <span class="string">&#x27;-&#x27;</span> + high</span><br><span class="line">        day_text = data_today[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            day_img = Image.<span class="built_in">open</span>(<span class="string">&#x27;..\\Requirement\\img\\big_weather_img\\&#x27;</span> + day_text + <span class="string">&#x27;.png&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">            day_img = Image.<span class="built_in">open</span>(<span class="string">&#x27;..\\Requirement\\img\\big_weather_img\\NA.png&#x27;</span>)</span><br><span class="line">        tem_now = json_weather[<span class="string">&#x27;wendu&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(tem_now) &lt; <span class="number">10</span>:</span><br><span class="line">            tem_now = <span class="string">&#x27; &#x27;</span> + tem_now</span><br><span class="line">        tips = json_weather[<span class="string">&#x27;ganmao&#x27;</span>]  <span class="comment"># 插入换行符</span></span><br><span class="line">        tips = tips[<span class="number">0</span>:<span class="number">21</span>] + <span class="string">&#x27;\n&#x27;</span> + tips[<span class="number">21</span>:-<span class="number">1</span>]</span><br><span class="line">        ttf = ImageFont.truetype(self.ttf_path, <span class="number">14</span>)</span><br><span class="line">        img_draw.text((<span class="number">58</span>, <span class="number">77</span>), <span class="string">&#x27;℃&#x27;</span>, font=ttf, fill=(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line">        img_draw.text((<span class="number">59</span>, <span class="number">94</span>), day_type, font=ttf, fill=(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line">        ttf = ImageFont.truetype(self.ttf_path, <span class="number">39</span>)</span><br><span class="line">        img_draw.text((<span class="number">18</span>, <span class="number">75</span>), tem_now, font=ttf, fill=(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line">        ttf = ImageFont.truetype(self.ttf_path, <span class="number">12</span>)</span><br><span class="line">        img_draw.text((<span class="number">22</span>, <span class="number">128</span>), <span class="string">&#x27;tip:&#x27;</span> + tips + <span class="string">&#x27; (天气仅供参考,请以实际为准哦qwq)&#x27;</span>, font=ttf, fill=(<span class="number">240</span>, <span class="number">240</span>, <span class="number">240</span>))</span><br><span class="line">        img_draw.text((<span class="number">35</span>, <span class="number">109</span>), temperature, font=ttf, fill=(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line">        back_ground.paste(day_img, (<span class="number">18</span>, <span class="number">30</span>), day_img)</span><br><span class="line">        back_ground.save(<span class="string">&#x27;..\\file\\temp\\res.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    a = WeatherApi()</span><br><span class="line">    <span class="built_in">print</span>(a.get_weather(<span class="string">&#x27;温州&#x27;</span>))</span><br><span class="line">    a.img_crate(a.get_weather(<span class="string">&#x27;温州&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>这段代码可以做到什么？它可以返回一个这样的图片</p>
<img src="/2022/03/10/crawler-1/p5.png" class="" title="代码返回示例">

<p>这段代码用到了python的pillow库这是一个图片绘制的库，但核心其实就是爬虫。</p>
<p>这是一个很初级的网络爬虫。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Mai-icy/weather_image_320x160">源码在这!</a></p>

        </article>
        <section class="post-near">
            <ul>
                
                    <li>上一篇: 看完啦 (つд⊂)</li>
                
                
                    <li>下一篇: <a href="/2022/03/09/hello-world/">搭建博客ヾ(≧▽≦*)o</a></li>
                
            </ul>
        </section>
        
            <section class="post-tags">
            <a class="-none-link" href="/tags/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/" rel="tag">网络爬虫</a>
            </section>
        
    
        <section class="post-author">
        
            <figure class="author-avatar">
                <img src="https://sdn.geekzu.org/avatar/b4bb31de44ce157568a6b61fa63ebfd8?s=80" alt="Mai Icy" />
            </figure>
        
            <div class="author-info">
                <h4>Mai Icy</h4>
                <p>wwwwwww</p>
            </div>
        </section>
    
    </div>
</main>

    <footer>
    <div class="buttons">
        <a class="to-top" href="#"></a>
    </div>
    <div class="wrap min">
        <section class="widget">
            <div class="row">
                <div class="col-m-4">
                    <h3 class="title-recent">最新文章：</h3>
                    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/03/10/crawler-1/">爬虫学习(1) - 超基础篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/03/09/hello-world/">搭建博客ヾ(≧▽≦*)o</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-date">时光机：</h3>
                    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-tags">标签云：</h3>
                    <a href="/tags/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/" style="font-size: 10px;">网络爬虫</a>
                </div>
            </div>
        </section>
        <section class="sub-footer">
            <p>© 2022 <a href="/">Mai Icy</a>. All Rights Reserved. Theme By <a href="https://github.com/Dreamer-Paul/Hingle" target="_blank" rel="nofollow">Hingle</a>.</p>
        </section>
    </div>
</footer>


<script src="/static/kico.js"></script>
<script src="/static/hingle.js"></script>


<script>var hingle = new Paul_Hingle({"copyright":true,"night":true});</script>

  </body>
</html>
