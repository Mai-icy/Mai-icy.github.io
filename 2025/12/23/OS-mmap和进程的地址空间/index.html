<!DOCTYPE html>
<html>
  <head>
     
    <meta charset="UTF-8">
    <title>操作系统笔记——mmap 和进程的地址空间 - Mai Icy</title>
    <link rel="shortcut icon" href="/static/img/icon.png">
    <link rel="icon" href="/static/img/icon.png" sizes="192x192"/>
    
<link rel="stylesheet" href="/static/kico.css">
<link rel="stylesheet" href="/static/hingle.css">

    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1"/>
    <meta property="og:site_name" content="Mai Icy">
    <meta property="og:title" content="操作系统笔记——mmap 和进程的地址空间"/>
    
<meta name="generator" content="Hexo 6.2.0"></head>

  <body>
    <header>
    <div class="head-title">
        <h4>Mai Icy</h4>
    </div>
    <div class="head-action">
        <div class="toggle-btn"></div>
        <div class="light-btn"></div>
        <div class="search-btn"></div>
    </div>
    <form class="head-search" method="post">
        <input type="text" name="s" placeholder="搜索什么？">
    </form>
    <nav class="head-menu">
        <a href="/">首页</a>
        <div class="has-child">
            <a>分类</a>
            <div class="sub-menu">
                <a class="category-link" href="/categories/C/">C</a><a class="category-link" href="/categories/java/">java</a><a class="category-link" href="/categories/python/">python</a><a class="category-link" href="/categories/rust/">rust</a><a class="category-link" href="/categories/%E5%A4%A7%E6%A8%A1%E5%9E%8B/">大模型</a><a class="category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a><a class="category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><a class="category-link" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a><a class="category-link" href="/categories/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">算法学习笔记</a><a class="category-link" href="/categories/%E7%AE%97%E6%B3%95%E8%AF%BE%E7%AC%94%E8%AE%B0/">算法课笔记</a><a class="category-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%AC%94%E8%AE%B0/">计算机网络笔记</a>
            </div>
        </div>
        
            <a href="/about">关于我</a>
        
            <a href="/friends">朋友们</a>
        
    </nav>
</header>

    <main>
    <div class="wrap min">
        <section class="post-title">
            <h2>操作系统笔记——mmap 和进程的地址空间</h2>
            <div class="post-meta">
                <time class="date">2025.12.23</time>
            
                <span class="category"><a class="category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a></span>
            
            </div>
        </section>
        <article class="post-content">
        
            <p>既然已经了解了进程的创建和关闭，下面就来了解进程的详细内容。</p>
<h1>基本前提整理</h1>
<p>我们首先明确一个基本前提：进程所看到的地址空间是一个抽象的虚拟地址空间。</p>
<p>对进程而言，内存只体现为一段逻辑地址的集合，而其具体映射到物理内存还是外存、如何进行地址转换与缓存加速，均由 MMU 与内核在后台完成，这些不属于本文讨论范围。</p>
<p>进程可以通过系统调用请求创建或扩展内存映射，但虚拟地址的具体布局（如位置、连续性与对齐）通常由内核和运行时系统共同决定，对应用程序而言大多是透明的。</p>
<p>本文将重点关注进程在用户态层面如何管理和使用其逻辑地址空间。</p>
<h1>实验观察进程地址空间：全局变量和代码块</h1>
<h2 id="实验程序">实验程序</h2>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> arr<span class="token punctuation">[</span><span class="token number">10485760</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">asm</span> <span class="token keyword">volatile</span><span class="token punctuation">(</span>
        <span class="token string">".rept 10485760"</span>
          <span class="token string">"nop"</span>
        <span class="token string">".endr"</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="asm">asm</h3>
<p><code>asm</code>（或 <code>__asm__</code>）是 GCC / Clang 提供的内联汇编机制，用于在 C/C++ 代码中直接插入汇编指令。我们将通过asm往代码空间快速插入，来扩充使得代码空间到一定大小，可以在实验的地址空间中定位和验证。</p>
<h3 id="volatile">volatile</h3>
<p><code>volatile</code> 用来告知编译器该内联汇编具有不可见但真实的副作用，禁止优化器将其删除或随意重排。它保证汇编指令在最终生成的代码中确实存在，但并不自动提供内存访问顺序的约束。防止编译器优化掉这段无意义扩充。</p>
<h3 id="总结">总结</h3>
<p>该程序在全局作用域定义了一个大小为 10 MB 的字符数组 <code>arr</code>，由于未显式初始化，它在语义上属于 <code>.bss</code> 段的全局静态存储区。<code>main</code> 函数中通过 <code>asm volatile</code> 插入了一段内联汇编，利用汇编器伪指令 <code>.rept</code> 在编译阶段展开并生成约 10 MB 的连续 <code>nop</code> 指令，从而显著拉长程序的代码段；<code>volatile</code> 确保这段指令序列不会被编译器优化删除或重排，因此在最终生成的可执行文件中真实存在。</p>
<p>使用gdb 调用 <code>info proc mappings</code> 和 <code>info registers</code></p>
<p>观察 <code>execve</code> 之后进程的内存布局与寄存器初始状态</p>
<h2 id="查看地址空间">查看地址空间</h2>
<p>展现结果：</p>
<pre class="line-numbers language-none"><code class="language-none">(gdb) info proc mappings
process 32914
Mapped address spaces:

          Start Addr           End Addr       Size     Offset  Perms  objfile
      0x555555554000     0x555555555000     0x1000        0x0  r--p   &#x2F;home&#x2F;maiicy&#x2F;Desktop&#x2F;code&#x2F;cpp-code&#x2F;tmp-code&#x2F;tmp
      0x555555555000     0x555555f56000   0xa01000     0x1000  r-xp   &#x2F;home&#x2F;maiicy&#x2F;Desktop&#x2F;code&#x2F;cpp-code&#x2F;tmp-code&#x2F;tmp
      0x555555f56000     0x555555f57000     0x1000   0xa02000  r--p   &#x2F;home&#x2F;maiicy&#x2F;Desktop&#x2F;code&#x2F;cpp-code&#x2F;tmp-code&#x2F;tmp
      0x555555f57000     0x555555f58000     0x1000   0xa02000  r--p   &#x2F;home&#x2F;maiicy&#x2F;Desktop&#x2F;code&#x2F;cpp-code&#x2F;tmp-code&#x2F;tmp
      0x555555f58000     0x555555f59000     0x1000   0xa03000  rw-p   &#x2F;home&#x2F;maiicy&#x2F;Desktop&#x2F;code&#x2F;cpp-code&#x2F;tmp-code&#x2F;tmp
      0x555555f59000     0x555556959000   0xa00000        0x0  rw-p   
      0x7ffff7c00000     0x7ffff7c28000    0x28000        0x0  r--p   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6
      0x7ffff7c28000     0x7ffff7dbd000   0x195000    0x28000  r-xp   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6
      0x7ffff7dbd000     0x7ffff7e15000    0x58000   0x1bd000  r--p   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6
      0x7ffff7e15000     0x7ffff7e16000     0x1000   0x215000  ---p   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6
      0x7ffff7e16000     0x7ffff7e1a000     0x4000   0x215000  r--p   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6
      0x7ffff7e1a000     0x7ffff7e1c000     0x2000   0x219000  rw-p   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6
      0x7ffff7e1c000     0x7ffff7e29000     0xd000        0x0  rw-p   
      0x7ffff7fa5000     0x7ffff7fa8000     0x3000        0x0  rw-p   
      0x7ffff7fbb000     0x7ffff7fbd000     0x2000        0x0  rw-p   
      0x7ffff7fbd000     0x7ffff7fbf000     0x2000        0x0  r--p   [vvar]
      0x7ffff7fbf000     0x7ffff7fc1000     0x2000        0x0  r--p   [vvar_vclock]
      0x7ffff7fc1000     0x7ffff7fc3000     0x2000        0x0  r-xp   [vdso]
      0x7ffff7fc3000     0x7ffff7fc5000     0x2000        0x0  r--p   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;ld-linux-x86-64.so.2
      0x7ffff7fc5000     0x7ffff7fef000    0x2a000     0x2000  r-xp   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;ld-linux-x86-64.so.2
      0x7ffff7fef000     0x7ffff7ffa000     0xb000    0x2c000  r--p   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;ld-linux-x86-64.so.2
      0x7ffff7ffb000     0x7ffff7ffd000     0x2000    0x37000  r--p   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;ld-linux-x86-64.so.2
      0x7ffff7ffd000     0x7ffff7fff000     0x2000    0x39000  rw-p   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;ld-linux-x86-64.so.2
      0x7ffffffde000     0x7ffffffff000    0x21000        0x0  rw-p   [stack]
  0xffffffffff600000 0xffffffffff601000     0x1000        0x0  --xp   [vsyscall]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>分析内容：</p>
<h3 id="Linux-进程地址空间映射总结表-by-AI（info-proc-mappings）">Linux 进程地址空间映射总结表 by AI（<code>info proc mappings</code>）</h3>
<table>
<thead>
<tr>
<th>类别</th>
<th>地址区间示例</th>
<th>权限</th>
<th>映射对象</th>
<th>主要内容</th>
<th>说明 / 备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>程序 ELF 头 / 只读段</strong></td>
<td><code>0x5555…4000–5000</code></td>
<td>r–p</td>
<td>程序本身</td>
<td>ELF Header、Program Header、<code>.rodata</code></td>
<td>加载器读取元信息</td>
</tr>
<tr>
<td><strong>程序代码段 <code>.text</code></strong></td>
<td><code>0x5555…5000–f56000</code></td>
<td>r-xp</td>
<td>程序本身</td>
<td>指令代码（含你的 10MB NOP）</td>
<td><strong>核心执行区</strong></td>
</tr>
<tr>
<td><strong>只读数据 / RELRO</strong></td>
<td><code>0x5555…f56000–f58000</code></td>
<td>r–p</td>
<td>程序本身</td>
<td><code>.rodata</code>、<code>.eh_frame</code></td>
<td>运行期不可修改</td>
</tr>
<tr>
<td><strong>初始化数据段 <code>.data</code></strong></td>
<td><code>0x5555…f58000–f59000</code></td>
<td>rw-p</td>
<td>程序本身</td>
<td>初始化全局变量</td>
<td>可读写</td>
</tr>
<tr>
<td><strong>未初始化数据 <code>.bss</code></strong></td>
<td><code>0x5555…f59000–969000</code></td>
<td>rw-p</td>
<td>匿名</td>
<td><code>char arr[10MB]</code></td>
<td><strong>你定义的全局数组</strong></td>
</tr>
<tr>
<td><strong>libc ELF 只读段</strong></td>
<td><code>0x7fff…0000–28000</code></td>
<td>r–p</td>
<td>libc.so.6</td>
<td>ELF 头、只读数据</td>
<td>C 运行时</td>
</tr>
<tr>
<td><strong>libc 代码段</strong></td>
<td><code>0x7fff…28000–dbd000</code></td>
<td>r-xp</td>
<td>libc.so.6</td>
<td><code>printf</code>、<code>malloc</code> 等</td>
<td>高频调用</td>
</tr>
<tr>
<td><strong>libc guard page</strong></td>
<td><code>0x7fff…15000–16000</code></td>
<td>—p</td>
<td>libc.so.6</td>
<td>越界保护页</td>
<td>防止非法访问</td>
</tr>
<tr>
<td><strong>libc 数据段</strong></td>
<td><code>0x7fff…16000–29000</code></td>
<td>rw-p</td>
<td>libc.so.6</td>
<td>libc 全局状态</td>
<td>内部使用</td>
</tr>
<tr>
<td><strong>匿名映射区</strong></td>
<td><code>0x7fff…fa5000</code> 等</td>
<td>rw-p</td>
<td>anonymous</td>
<td>malloc / TLS / pthread</td>
<td>运行时动态分配</td>
</tr>
<tr>
<td><strong>vvar</strong></td>
<td><code>0x7fff…fbd000–fbf000</code></td>
<td>r–p</td>
<td><code>[vvar]</code></td>
<td>时间/CPU 数据</td>
<td>内核映射</td>
</tr>
<tr>
<td><strong>vvar_vclock</strong></td>
<td><code>0x7fff…fbf000–fc1000</code></td>
<td>r–p</td>
<td><code>[vvar_vclock]</code></td>
<td>高精度时钟</td>
<td>无 syscall</td>
</tr>
<tr>
<td><strong>vdso</strong></td>
<td><code>0x7fff…fc1000–fc3000</code></td>
<td>r-xp</td>
<td><code>[vdso]</code></td>
<td><code>clock_gettime</code> 等</td>
<td>用户态内核函数</td>
</tr>
<tr>
<td><strong>动态链接器只读段</strong></td>
<td><code>0x7fff…fc3000–fc5000</code></td>
<td>r–p</td>
<td>ld-linux</td>
<td>ELF/rodata</td>
<td>程序启动</td>
</tr>
<tr>
<td><strong>动态链接器代码段</strong></td>
<td><code>0x7fff…fc5000–fef000</code></td>
<td>r-xp</td>
<td>ld-linux</td>
<td>符号解析</td>
<td>程序加载</td>
</tr>
<tr>
<td><strong>动态链接器数据段</strong></td>
<td><code>0x7fff…ffd000–fff000</code></td>
<td>rw-p</td>
<td>ld-linux</td>
<td>链接器状态</td>
<td>启动后常驻</td>
</tr>
<tr>
<td><strong>用户栈</strong></td>
<td><code>0x7fff…fde000–fffff000</code></td>
<td>rw-p</td>
<td><code>[stack]</code></td>
<td>函数栈帧</td>
<td>向下增长</td>
</tr>
<tr>
<td><strong>vsyscall（历史）</strong></td>
<td><code>0xffff…600000</code></td>
<td>–xp</td>
<td><code>[vsyscall]</code></td>
<td>旧系统调用</td>
<td>已废弃</td>
</tr>
</tbody>
</table>
<p>可以看到我们定义的10MB大内容在两个地方：</p>
<ul>
<li>第二行的程序代码段，就是我们使用asm扩充的代码段。</li>
<li>第六行的匿名段也就是运行起来后生成的10MB字符数组占用空间。</li>
</ul>
<h3 id="vvar"><strong>vvar</strong></h3>
<p>vvar 是内核将部分只读的时间与 CPU 状态数据以只读页的形式映射到用户态，使用户程序在多数情况下无需陷入内核即可读取高精度时间信息，从而显著减少系统调用开销。</p>
<p>例如传统模式下：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
→ syscall
→ 内核态
→ 读取时间
→ 返回用户态<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>需要 <strong>用户态 ↔ 内核态切换</strong></li>
<li>在高频调用（日志、profiling、调度）中代价明显</li>
</ul>
<h3 id="vsdo">vsdo</h3>
<p><strong>vDSO</strong> 是内核向用户态映射的一段只读、可执行的共享代码页。它以“看起来像一个共享库”的形式存在，但不在磁盘上，而是由内核在进程启动时直接映射到用户地址空间。</p>
<p>其核心目标是：让某些原本需要系统调用的内核服务，在用户态通过普通函数调用完成。</p>
<p>典型用途包括：</p>
<ul>
<li><code>gettimeofday</code></li>
<li><code>clock_gettime</code></li>
<li><code>time</code></li>
<li><code>getcpu</code>（部分架构）</li>
</ul>
<p>以 <code>clock_gettime(CLOCK_MONOTONIC)</code> 为例：</p>
<pre class="line-numbers language-none"><code class="language-none">clock_gettime()
→ 调用 vDSO 中的用户态函数
→ 读取 vvar 中的时间&#x2F;CPU 数据
→ 必要时做轻量校正
→ 返回用户态结果<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="vDSO-与-vvar-的关系">vDSO 与 vvar 的关系</h3>
<p>可以将二者理解为 “数据 + 代码” 的配套设计：</p>
<table>
<thead>
<tr>
<th>组件</th>
<th>角色</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>vvar</strong></td>
<td>提供只读的、由内核维护的时间与 CPU 状态数据页</td>
</tr>
<tr>
<td><strong>vDSO</strong></td>
<td>提供用户态可执行的“封装函数”，负责读取 vvar 并处理细节</td>
</tr>
</tbody>
</table>
<p>也就是说：正常情况下用户程序不会、也不应当直接读取 vvar；而是通过 vDSO 提供的函数接口来间接使用其中的数据。</p>
<h3 id="题外话：wsl上的-gdb-效果">题外话：wsl上的 gdb 效果</h3>
<pre class="line-numbers language-none"><code class="language-none">(gdb) info proc mappings
process 3353
Mapped address spaces:

          Start Addr           End Addr       Size     Offset  Perms  objfile
      0x555555554000     0x555555555000     0x1000        0x0  r--p   &#x2F;mnt&#x2F;e&#x2F;code&#x2F;linux-code&#x2F;cpp-code&#x2F;execve&#x2F;mock
      0x555555555000     0x555555f56000   0xa01000     0x1000  r-xp   &#x2F;mnt&#x2F;e&#x2F;code&#x2F;linux-code&#x2F;cpp-code&#x2F;execve&#x2F;mock
      0x555555f56000     0x555555f57000     0x1000   0xa02000  r--p   &#x2F;mnt&#x2F;e&#x2F;code&#x2F;linux-code&#x2F;cpp-code&#x2F;execve&#x2F;mock
      0x555555f57000     0x555555f58000     0x1000   0xa02000  r--p   &#x2F;mnt&#x2F;e&#x2F;code&#x2F;linux-code&#x2F;cpp-code&#x2F;execve&#x2F;mock
      0x555555f58000     0x555555f59000     0x1000   0xa03000  rw-p   &#x2F;mnt&#x2F;e&#x2F;code&#x2F;linux-code&#x2F;cpp-code&#x2F;execve&#x2F;mock
      0x555555f59000     0x555556959000   0xa00000        0x0  rw-p   [heap]
      0x7ffff7da0000     0x7ffff7da3000     0x3000        0x0  rw-p   
      0x7ffff7da3000     0x7ffff7dcb000    0x28000        0x0  r--p   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6
      0x7ffff7dcb000     0x7ffff7f53000   0x188000    0x28000  r-xp   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6
      0x7ffff7f53000     0x7ffff7fa2000    0x4f000   0x1b0000  r--p   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6
      0x7ffff7fa2000     0x7ffff7fa6000     0x4000   0x1fe000  r--p   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6
      0x7ffff7fa6000     0x7ffff7fa8000     0x2000   0x202000  rw-p   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6
      0x7ffff7fa8000     0x7ffff7fb5000     0xd000        0x0  rw-p   
      0x7ffff7fbd000     0x7ffff7fbf000     0x2000        0x0  rw-p   
      0x7ffff7fbf000     0x7ffff7fc3000     0x4000        0x0  r--p   [vvar]
      0x7ffff7fc3000     0x7ffff7fc5000     0x2000        0x0  r-xp   [vdso]
      0x7ffff7fc5000     0x7ffff7fc6000     0x1000        0x0  r--p   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;ld-linux-x86-64.so.2
      0x7ffff7fc6000     0x7ffff7ff1000    0x2b000     0x1000  r-xp   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;ld-linux-x86-64.so.2
      0x7ffff7ff1000     0x7ffff7ffb000     0xa000    0x2c000  r--p   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;ld-linux-x86-64.so.2
      0x7ffff7ffb000     0x7ffff7ffd000     0x2000    0x36000  r--p   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;ld-linux-x86-64.so.2
      0x7ffff7ffd000     0x7ffff7fff000     0x2000    0x38000  rw-p   &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;ld-linux-x86-64.so.2
      0x7ffffffdd000     0x7ffffffff000    0x22000        0x0  rw-p   [stack]
(gdb) <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在 Ubuntu 真机系统中，进程地址空间包含 vvar_vclock 和 vsyscall 等与硬件时钟及历史系统调用优化相关的特殊映射；而在 WSL 环境中，由于其运行于虚拟化或兼容层之上，内核不直接控制底层硬件，因此不提供 vvar_vclock 和 vsyscall 映射，仅保留 vDSO 与基础 vvar 以保证用户态时间接口的语义正确性。</p>
<h2 id="查看寄存器空间">查看寄存器空间</h2>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> starti
Starting program<span class="token operator">:</span> <span class="token operator">/</span>mnt<span class="token operator">/</span>e<span class="token operator">/</span>code<span class="token operator">/</span>linux<span class="token operator">-</span>code<span class="token operator">/</span>cpp<span class="token operator">-</span>code<span class="token operator">/</span>execve<span class="token operator">/</span>mock_static 

Program stopped<span class="token punctuation">.</span>
<span class="token number">0x0000000000401740</span> in <span class="token function">_start</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> info registers
rax            <span class="token number">0x0</span>                 <span class="token number">0</span>
rbx            <span class="token number">0x0</span>                 <span class="token number">0</span>
rcx            <span class="token number">0x0</span>                 <span class="token number">0</span>
rdx            <span class="token number">0x0</span>                 <span class="token number">0</span>
rsi            <span class="token number">0x0</span>                 <span class="token number">0</span>
rdi            <span class="token number">0x0</span>                 <span class="token number">0</span>
rbp            <span class="token number">0x0</span>                 <span class="token number">0x0</span>
rsp            <span class="token number">0x7fffffffda00</span>      <span class="token number">0x7fffffffda00</span>
r8             <span class="token number">0x0</span>                 <span class="token number">0</span>
r9             <span class="token number">0x0</span>                 <span class="token number">0</span>
r10            <span class="token number">0x0</span>                 <span class="token number">0</span>
r11            <span class="token number">0x0</span>                 <span class="token number">0</span>
r12            <span class="token number">0x0</span>                 <span class="token number">0</span>
r13            <span class="token number">0x0</span>                 <span class="token number">0</span>
r14            <span class="token number">0x0</span>                 <span class="token number">0</span>
r15            <span class="token number">0x0</span>                 <span class="token number">0</span>
rip            <span class="token number">0x401740</span>            <span class="token number">0x401740</span> <span class="token operator">&lt;</span>_start<span class="token operator">></span>
eflags         <span class="token number">0x200</span>               <span class="token punctuation">[</span> IF <span class="token punctuation">]</span>
cs             <span class="token number">0x33</span>                <span class="token number">51</span>
ss             <span class="token number">0x2b</span>                <span class="token number">43</span>
ds             <span class="token number">0x0</span>                 <span class="token number">0</span>
es             <span class="token number">0x0</span>                 <span class="token number">0</span>
fs             <span class="token number">0x0</span>                 <span class="token number">0</span>
gs             <span class="token number">0x0</span>                 <span class="token number">0</span>
fs_base        <span class="token number">0x0</span>                 <span class="token number">0</span>
gs_base        <span class="token number">0x0</span>                 <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>同时我们可以使用readelf来获取ELF的文件头数据</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">$ readelf <span class="token operator">-</span>h <span class="token punctuation">.</span><span class="token operator">/</span>mock_static
ELF Header<span class="token operator">:</span>
  Magic<span class="token operator">:</span>   <span class="token number">7f</span> <span class="token number">45</span> <span class="token number">4</span>c <span class="token number">46</span> <span class="token number">02</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">03</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> 
  Class<span class="token operator">:</span>                             ELF64
  Data<span class="token operator">:</span>                              <span class="token number">2</span>'s complement<span class="token punctuation">,</span> little endian
  Version<span class="token operator">:</span>                           <span class="token number">1</span> <span class="token punctuation">(</span>current<span class="token punctuation">)</span>
  OS<span class="token operator">/</span>ABI<span class="token operator">:</span>                            UNIX <span class="token operator">-</span> GNU
  ABI Version<span class="token operator">:</span>                       <span class="token number">0</span>
  Type<span class="token operator">:</span>                              <span class="token function">EXEC</span> <span class="token punctuation">(</span>Executable file<span class="token punctuation">)</span>
  Machine<span class="token operator">:</span>                           Advanced Micro Devices X86<span class="token operator">-</span><span class="token number">64</span>
  Version<span class="token operator">:</span>                           <span class="token number">0x1</span>
  Entry point address<span class="token operator">:</span>               <span class="token number">0x401740</span>
  Start of program headers<span class="token operator">:</span>          <span class="token number">64</span> <span class="token punctuation">(</span>bytes into file<span class="token punctuation">)</span>
  Start of section headers<span class="token operator">:</span>          <span class="token number">11269232</span> <span class="token punctuation">(</span>bytes into file<span class="token punctuation">)</span>
  Flags<span class="token operator">:</span>                             <span class="token number">0x0</span>
  Size of this header<span class="token operator">:</span>               <span class="token number">64</span> <span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>
  Size of program headers<span class="token operator">:</span>           <span class="token number">56</span> <span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>
  Number of program headers<span class="token operator">:</span>         <span class="token number">10</span>
  Size of section headers<span class="token operator">:</span>           <span class="token number">64</span> <span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>
  Number of section headers<span class="token operator">:</span>         <span class="token number">28</span>
  Section header string table index<span class="token operator">:</span> <span class="token number">27</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们可以发现，rip寄存器（CPU 下一条将要执行的指令的虚拟地址）与elf header中的 <code>Entry point address</code> 值一致。</p>
<p>可以看到，elf头和其执行效果是密切相关的，实际上，一个elf是否能在系统上可以执行，也是有完整的一套标准的，也就是ABI，只要符合对应系统采用的ABI，这个系统就可以处理这个ELF。</p>
<h2 id="ABI（Application-Binary-Interface）简介">ABI（Application Binary Interface）简介</h2>
<p>ABI（Application Binary Interface，应用二进制接口）定义了已经编译好的二进制程序之间，以及程序与操作系统之间如何正确协作。</p>
<p>如果说 API 解决的是“源码层面如何调用”，那么 ABI 解决的就是：不同模块在二进制层面，如何在不重新编译的前提下正确运行。</p>
<p>在现代操作系统中，ABI 是进程能否成功启动、函数能否正确调用、库能否被安全复用的根本前提。</p>
<h3 id="System-V-AMD64-ABI">System V AMD64 ABI</h3>
<p>Linux / BSD / macOS（x86-64）的事实标准</p>
<p>链接：<a target="_blank" rel="noopener" href="https://refspecs.linuxfoundation.org/elf/x86_64-abi-0.99.pdf">https://refspecs.linuxfoundation.org/elf/x86_64-abi-0.99.pdf</a></p>
<h1>进程的地址空间</h1>
<p>刚才的演示只能从程序里确定的静态空间来分配地址，已经分配了众多的空间。</p>
<h2 id="mmap-——-建立新的虚拟内存映射">mmap —— 建立新的虚拟内存映射</h2>
<h3 id="函数原型">函数原型</h3>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">mmap</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>addr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> length<span class="token punctuation">,</span> <span class="token keyword">int</span> prot<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">,</span> <span class="token keyword">int</span> fd<span class="token punctuation">,</span> <span class="token class-name">off_t</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="参数说明">参数说明</h3>
<ul>
<li><code>addr</code> ：建议映射的起始虚拟地址，通常传 <code>NULL</code> 由内核自动选择合适地址。</li>
<li><code>length</code> ：映射区域的长度（字节数），实际会按页大小对齐。</li>
<li><code>prot</code> ： 映射区域的访问权限，如 <code>PROT_READ</code>、<code>PROT_WRITE</code>、<code>PROT_EXEC</code>。</li>
<li><code>flags</code> ： 映射类型和行为控制，如 <code>MAP_PRIVATE</code>、<code>MAP_SHARED</code>、<code>MAP_ANONYMOUS</code>。</li>
<li><code>fd</code> ：被映射文件的文件描述符；匿名映射时可传 <code>-1</code>。</li>
<li><code>offset</code> ：文件映射的起始偏移，必须是页大小的整数倍。</li>
</ul>
<h3 id="核心作用">核心作用</h3>
<p><code>mmap</code> 在进程的虚拟地址空间中创建一段新的内存映射，用于将文件内容、设备或匿名内存按页映射到用户空间，从而支持程序加载、共享库映射、大块内存分配以及高效的文件 I/O。</p>
<h2 id="munmap-——-解除已有的内存映射">munmap —— 解除已有的内存映射</h2>
<h3 id="函数原型-2">函数原型</h3>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">intmunmap</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>addr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="参数说明-2">参数说明</h3>
<ul>
<li><code>addr</code> ：要解除映射的内存区域起始地址，必须是此前 <code>mmap</code> 返回的地址或其页对齐地址。</li>
<li><code>length</code> ：解除映射的长度（字节数），同样按页大小对齐。</li>
</ul>
<h3 id="核心作用-2">核心作用</h3>
<p><code>munmap</code> 用于撤销进程地址空间中一段已存在的内存映射，使对应的虚拟地址区间不再有效，常用于释放通过 <code>mmap</code> 申请的内存或解除文件映射，在进程退出时也会由内核统一执行。</p>
<h2 id="mprotect-——-修改内存访问权限">mprotect —— 修改内存访问权限</h2>
<h3 id="函数原型-3">函数原型</h3>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">intmprotect</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>addr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> length<span class="token punctuation">,</span> <span class="token keyword">int</span> prot<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="参数说明-3">参数说明</h3>
<ul>
<li><code>addr</code> ：需要修改权限的内存区域起始地址，必须页对齐。</li>
<li><code>length</code> ：需要修改权限的区域长度（字节数）。</li>
<li><code>prot</code> ：新的访问权限组合，如 <code>PROT_READ</code>、<code>PROT_WRITE</code>、<code>PROT_EXEC</code>、<code>PROT_NONE</code>。</li>
</ul>
<h3 id="核心作用-3">核心作用</h3>
<p><code>mprotect</code> 用于动态调整进程地址空间中某段已映射内存的访问权限，常用于实现代码段保护（只读可执行）、运行时内存安全控制，以及 JIT 场景下写权限与执行权限的切换。</p>
<h2 id="查看进程的地址空间-pmap">查看进程的地址空间 <code>pmap</code></h2>
<p><code>pmap</code> 是 Linux 提供的用户态工具，用于查看某个进程当前的虚拟地址空间映射情况。它以人类可读的形式展示进程中各个虚拟内存区域的起始地址、大小、权限及来源。</p>
<h3 id="基本用法">基本用法</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pmap <span class="token operator">&lt;</span>pid<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>或查看更详细信息：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pmap <span class="token parameter variable">-x</span> <span class="token operator">&lt;</span>pid<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="实际输出例子">实际输出例子</h3>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">$ pmap <span class="token number">366</span>
<span class="token number">366</span><span class="token operator">:</span>   <span class="token operator">-</span>bash
<span class="token number">0000559</span>b8ee48000    <span class="token number">192</span>K r<span class="token operator">--</span><span class="token operator">--</span> bash
<span class="token number">0000559</span>b8ee78000    <span class="token number">956</span>K r<span class="token operator">-</span>x<span class="token operator">--</span> bash
<span class="token number">0000559</span>b8ef67000    <span class="token number">212</span>K r<span class="token operator">--</span><span class="token operator">--</span> bash
<span class="token number">0000559</span>b8ef9c000     <span class="token number">16</span>K r<span class="token operator">--</span><span class="token operator">--</span> bash
<span class="token number">0000559</span>b8efa0000     <span class="token number">36</span>K rw<span class="token operator">--</span><span class="token operator">-</span> bash
<span class="token number">0000559</span>b8efa9000     <span class="token number">44</span>K rw<span class="token operator">--</span><span class="token operator">-</span>   <span class="token punctuation">[</span> anon <span class="token punctuation">]</span>
<span class="token number">0000559</span>bb96ad000   <span class="token number">1580</span>K rw<span class="token operator">--</span><span class="token operator">-</span>   <span class="token punctuation">[</span> anon <span class="token punctuation">]</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">717</span>c000    <span class="token number">356</span>K r<span class="token operator">--</span><span class="token operator">--</span> LC_CTYPE
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">71</span>d5000      <span class="token number">4</span>K r<span class="token operator">--</span><span class="token operator">--</span> LC_NUMERIC
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">71</span>d6000      <span class="token number">4</span>K r<span class="token operator">--</span><span class="token operator">--</span> LC_TIME
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">71</span>d7000      <span class="token number">4</span>K r<span class="token operator">--</span><span class="token operator">--</span> LC_COLLATE
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">71</span>d8000      <span class="token number">4</span>K r<span class="token operator">--</span><span class="token operator">--</span> LC_MONETARY
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">71</span>d9000      <span class="token number">4</span>K r<span class="token operator">--</span><span class="token operator">--</span> SYS_LC_MESSAGES
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">71</span>da000      <span class="token number">4</span>K r<span class="token operator">--</span><span class="token operator">--</span> LC_PAPER
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">71</span>db000      <span class="token number">4</span>K r<span class="token operator">--</span><span class="token operator">--</span> LC_NAME
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">71</span>dc000      <span class="token number">4</span>K r<span class="token operator">--</span><span class="token operator">--</span> LC_ADDRESS
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">71</span>dd000      <span class="token number">4</span>K r<span class="token operator">--</span><span class="token operator">--</span> LC_TELEPHONE
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">71</span>de000      <span class="token number">4</span>K r<span class="token operator">--</span><span class="token operator">--</span> LC_MEASUREMENT
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">71</span>df000   <span class="token number">2988</span>K r<span class="token operator">--</span><span class="token operator">--</span> locale<span class="token operator">-</span>archive
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">74</span>ca000     <span class="token number">12</span>K rw<span class="token operator">--</span><span class="token operator">-</span>   <span class="token punctuation">[</span> anon <span class="token punctuation">]</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">74</span>cd000    <span class="token number">160</span>K r<span class="token operator">--</span><span class="token operator">--</span> libc<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">74f</span><span class="token number">5000</span>   <span class="token number">1568</span>K r<span class="token operator">-</span>x<span class="token operator">--</span> libc<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">767</span>d000    <span class="token number">316</span>K r<span class="token operator">--</span><span class="token operator">--</span> libc<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">76</span>cc000     <span class="token number">16</span>K r<span class="token operator">--</span><span class="token operator">--</span> libc<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">76</span>d0000      <span class="token number">8</span>K rw<span class="token operator">--</span><span class="token operator">-</span> libc<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">76</span>d2000     <span class="token number">52</span>K rw<span class="token operator">--</span><span class="token operator">-</span>   <span class="token punctuation">[</span> anon <span class="token punctuation">]</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">76</span>df000     <span class="token number">56</span>K r<span class="token operator">--</span><span class="token operator">--</span> libtinfo<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6.4</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">76</span>ed000     <span class="token number">76</span>K r<span class="token operator">-</span>x<span class="token operator">--</span> libtinfo<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6.4</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">7700000</span>     <span class="token number">56</span>K r<span class="token operator">--</span><span class="token operator">--</span> libtinfo<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6.4</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">770e000</span>     <span class="token number">16</span>K r<span class="token operator">--</span><span class="token operator">--</span> libtinfo<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6.4</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">7712000</span>      <span class="token number">4</span>K rw<span class="token operator">--</span><span class="token operator">-</span> libtinfo<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6.4</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">7713000</span>     <span class="token number">28</span>K r<span class="token operator">--</span>s<span class="token operator">-</span> gconv<span class="token operator">-</span>modules<span class="token punctuation">.</span>cache
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">771</span>a000      <span class="token number">4</span>K r<span class="token operator">--</span><span class="token operator">--</span> LC_IDENTIFICATION
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">771</span>b000      <span class="token number">8</span>K rw<span class="token operator">--</span><span class="token operator">-</span>   <span class="token punctuation">[</span> anon <span class="token punctuation">]</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">771</span>d000      <span class="token number">4</span>K r<span class="token operator">--</span><span class="token operator">--</span> ld<span class="token operator">-</span>linux<span class="token operator">-</span>x86<span class="token operator">-</span><span class="token number">64.</span>so<span class="token punctuation">.</span><span class="token number">2</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">771e000</span>    <span class="token number">172</span>K r<span class="token operator">-</span>x<span class="token operator">--</span> ld<span class="token operator">-</span>linux<span class="token operator">-</span>x86<span class="token operator">-</span><span class="token number">64.</span>so<span class="token punctuation">.</span><span class="token number">2</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">7749000</span>     <span class="token number">40</span>K r<span class="token operator">--</span><span class="token operator">--</span> ld<span class="token operator">-</span>linux<span class="token operator">-</span>x86<span class="token operator">-</span><span class="token number">64.</span>so<span class="token punctuation">.</span><span class="token number">2</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">7753000</span>      <span class="token number">8</span>K r<span class="token operator">--</span><span class="token operator">--</span> ld<span class="token operator">-</span>linux<span class="token operator">-</span>x86<span class="token operator">-</span><span class="token number">64.</span>so<span class="token punctuation">.</span><span class="token number">2</span>
<span class="token number">00007f</span><span class="token number">93f</span><span class="token number">7755000</span>      <span class="token number">8</span>K rw<span class="token operator">--</span><span class="token operator">-</span> ld<span class="token operator">-</span>linux<span class="token operator">-</span>x86<span class="token operator">-</span><span class="token number">64.</span>so<span class="token punctuation">.</span><span class="token number">2</span>
<span class="token number">00007fff</span><span class="token number">34836000</span>    <span class="token number">132</span>K rw<span class="token operator">--</span><span class="token operator">-</span>   <span class="token punctuation">[</span> stack <span class="token punctuation">]</span>
<span class="token number">00007fff</span><span class="token number">34902000</span>     <span class="token number">16</span>K r<span class="token operator">--</span><span class="token operator">--</span>   <span class="token punctuation">[</span> anon <span class="token punctuation">]</span>
<span class="token number">00007fff</span><span class="token number">34906000</span>      <span class="token number">8</span>K r<span class="token operator">-</span>x<span class="token operator">--</span>   <span class="token punctuation">[</span> anon <span class="token punctuation">]</span>
 total             <span class="token number">9188</span>K<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>探讨问题：pmap的运行原理</p>
<p><code>pmap</code> 并不直接访问页表或内核内存管理结构，而是通过读取 <code>/proc/&lt;pid&gt;/maps</code> 及相关 procfs 文件，在用户态重建进程的虚拟地址空间视图。</p>
<p>通过strace可以一目了然</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">$ strace pmap <span class="token number">366</span> <span class="token number">2</span><span class="token operator">></span><span class="token operator">&amp;</span><span class="token number">1</span> <span class="token operator">|</span> grep <span class="token char">'proc/366'</span>
<span class="token function">openat</span><span class="token punctuation">(</span>AT_FDCWD<span class="token punctuation">,</span> <span class="token string">"/proc/366/status"</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span>
<span class="token function">newfstatat</span><span class="token punctuation">(</span>AT_FDCWD<span class="token punctuation">,</span> <span class="token string">"/proc/366"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>st_mode<span class="token operator">=</span>S_IFDIR<span class="token operator">|</span><span class="token number">0555</span><span class="token punctuation">,</span> st_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token function">openat</span><span class="token punctuation">(</span>AT_FDCWD<span class="token punctuation">,</span> <span class="token string">"/proc/366/stat"</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span>
<span class="token function">openat</span><span class="token punctuation">(</span>AT_FDCWD<span class="token punctuation">,</span> <span class="token string">"/proc/366/cmdline"</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span>
<span class="token function">openat</span><span class="token punctuation">(</span>AT_FDCWD<span class="token punctuation">,</span> <span class="token string">"/proc/366/maps"</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其核心操作就是读取这些内容，然后格式化输出出来。只是对maps的高级可读封装。</p>
<h3 id="proc-介绍">/proc 介绍</h3>
<p><code>/proc</code> 是 Linux 提供的一种虚拟文件系统（procfs），用于将内核内部的运行时状态以“文件”的形式暴露给用户空间程序。它不是磁盘上的真实文件系统，而是内核在内存中动态生成的接口层。</p>
<p>其是内核与用户态之间的一种只读/可控读写的信息通道，用于查询和配置系统及进程的运行状态。</p>
<p>其中文件内容并不持久存在，每一次 read 都是内核即时生成的结果。</p>
<p><code>/proc/pid/</code> 该目录中包含进程的核心运行信息，例如：</p>
<table>
<thead>
<tr>
<th>文件</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>maps</code></td>
<td>进程的虚拟地址空间映射</td>
</tr>
<tr>
<td><code>smaps</code></td>
<td>更详细的内存使用统计</td>
</tr>
<tr>
<td><code>stat</code></td>
<td>进程状态与调度信息</td>
</tr>
<tr>
<td><code>status</code></td>
<td>人类可读的进程摘要</td>
</tr>
<tr>
<td><code>cmdline</code></td>
<td>启动命令行</td>
</tr>
<tr>
<td><code>fd/</code></td>
<td>该进程打开的文件描述符</td>
</tr>
</tbody>
</table>
<p>实际上，<code>ps</code>、<code>lsof</code>等也是依赖这个目录提供的信息接口。</p>
<h2 id="malloc-使用-mmap-行为">malloc 使用 mmap 行为</h2>
<p>对于进程而言，动态内存需求是常态。对 C 程序来说，通常通过 <code>malloc</code> 获取新的内存空间。</p>
<p>实际上，<code>malloc</code> 会根据申请大小，选择通过 <strong><code>brk</code></strong> 扩展 heap，或直接通过 <strong><code>mmap</code></strong> 向内核申请新的虚拟地址区间。</p>
<p>如果每一次 <code>malloc</code> 都直接调用 <code>mmap</code>，就会频繁陷入内核态，带来明显的性能开销。</p>
<p>在 Unix 进程模型中，进程地址空间天然包含一个可向上增长的数据区（heap），用于支持高频、小规模的动态内存分配，解决了频繁切换的问题。</p>
<h3 id="malloc的使用heap行为">malloc的使用heap行为</h3>
<p>以 glibc 的默认策略为例，当申请的内存 小于约 128KB 时，<code>malloc</code> 通常会将其分配在 heap 中。</p>
<p>heap 的行为类似于一个动态数组：当现有空间不足时，<code>malloc</code> 通过 <code>brk</code> 系统调用请求内核扩展 heap 的上界。</p>
<p>一旦 heap 扩展到足够大小，后续的小块内存分配与回收均可在<strong>用户态完成块级管理</strong>，无需再次进入内核态。</p>
<p>由于 heap 必须保持连续增长，当 heap 后方的虚拟地址空间已被 <code>mmap</code> 或其他映射占用时，<code>brk</code> 将无法继续扩展。</p>
<h3 id="malloc-直接使用-mmap">malloc 直接使用 mmap</h3>
<p>对于 大于约 128KB 的内存申请，<code>malloc</code> 通常直接使用 <code>mmap</code> 单独映射一段虚拟地址空间。</p>
<p>这种做法可以避免 heap 过快增长和碎片化问题，同时也更便于大块内存的独立回收。</p>
<h3 id="heap-无法精准-free">heap 无法精准 free</h3>
<p>由于 heap 中的内存由用户态的 <code>malloc</code> 统一管理，内核只感知整段 heap 的边界而不关心其内部块的使用情况，因此无法在块级别进行精准回收；相对地，基于 <code>mmap</code> 的内存分配以独立映射区间存在，释放时可以通过 <code>munmap</code> 明确告知内核整段地址不再使用。正是为了避免频繁进入内核态，小规模、高频的内存分配选择在 heap 中完成，而大块内存则直接使用 <code>mmap</code>。</p>
<h3 id="内存泄露">内存泄露</h3>
<p>在程序开始运行时，内核会为进程建立并初始化其虚拟地址空间布局；而在程序结束时，进程所占用的所有虚拟内存映射（包括 heap、mmap 等）都会被内核统一回收。因此，从操作系统层面来看，进程结束后并不存在真正意义上的内存泄露。</p>
<p>通常所说的内存泄露，指的是进程运行期间的问题：程序在用户态分配了内存（如通过 <code>malloc</code> 或 <code>mmap</code>），但由于逻辑错误丢失了对这些内存的引用，导致已分配的内存无法再被程序复用，从而使 heap 持续增长或虚拟内存占用不断增加。</p>
<h2 id="跟踪mmap创建的内存实验">跟踪mmap创建的内存实验</h2>
<p>示例程序</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PAGE_SIZE</span> <span class="token expression"><span class="token number">4096</span></span></span>

<span class="token keyword">void</span> <span class="token function">wait_point</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\\n=== %s ===\\n"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">wait_point</span><span class="token punctuation">(</span><span class="token string">"start program"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* 1. 匿名 mmap（私有，可写） */</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>anon1 <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> PAGE_SIZE<span class="token punctuation">,</span>
                       PROT_READ <span class="token operator">|</span> PROT_WRITE<span class="token punctuation">,</span>
                       MAP_PRIVATE <span class="token operator">|</span> MAP_ANONYMOUS<span class="token punctuation">,</span>
                       <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">wait_point</span><span class="token punctuation">(</span><span class="token string">"after anonymous mmap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* 2. 再映射一块更大的匿名区 */</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>anon2 <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> PAGE_SIZE <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">,</span>
                       PROT_READ <span class="token operator">|</span> PROT_WRITE<span class="token punctuation">,</span>
                       MAP_PRIVATE <span class="token operator">|</span> MAP_ANONYMOUS<span class="token punctuation">,</span>
                       <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">wait_point</span><span class="token punctuation">(</span><span class="token string">"after large anonymous mmap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* 3. 文件映射（只读） */</span>
    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"./empty.bin"</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>file_ro <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> PAGE_SIZE<span class="token punctuation">,</span>
                         PROT_READ<span class="token punctuation">,</span>
                         MAP_PRIVATE<span class="token punctuation">,</span>
                         fd<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">wait_point</span><span class="token punctuation">(</span><span class="token string">"after file-backed mmap (RO)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* 4. 文件映射（可写，共享） */</span>
    <span class="token keyword">int</span> fd2 <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"./empty2.bin"</span><span class="token punctuation">,</span> O_RDWR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>file_rw <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> PAGE_SIZE<span class="token punctuation">,</span>
                         PROT_READ <span class="token operator">|</span> PROT_WRITE<span class="token punctuation">,</span>
                         MAP_SHARED<span class="token punctuation">,</span>
                         fd2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">wait_point</span><span class="token punctuation">(</span><span class="token string">"after file-backed mmap (RW, shared)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* 5. 解除一块映射 */</span>
    <span class="token function">munmap</span><span class="token punctuation">(</span>anon1<span class="token punctuation">,</span> PAGE_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">wait_point</span><span class="token punctuation">(</span><span class="token string">"after munmap anon1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fd2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">wait_point</span><span class="token punctuation">(</span><span class="token string">"end program"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="after-large-anonymous-mmap（大匿名-mmap）">after large anonymous mmap（大匿名 mmap）</h3>
<p>新增内容：</p>
<pre class="line-numbers language-none"><code class="language-none">0x7ffff7d96000 - 0x7ffff7da3000  rw-p<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<hr>
<h3 id="after-file-backed-mmap-RO">after file-backed mmap (RO)</h3>
<p>新增内容：</p>
<pre class="line-numbers language-none"><code class="language-none">0x7ffff7fbb000 - 0x7ffff7fbc000  r--p  empty.bin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="after-file-backed-mmap-RW-shared">after file-backed mmap (RW, shared)</h3>
<p>新增内容：</p>
<pre class="line-numbers language-none"><code class="language-none">0x7ffff7fba000 - 0x7ffff7fbb000  rw-s  empty2.bin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1>入侵进程的地址空间</h1>
<h2 id="金手指">金手指</h2>
<p>金手指作为早期游戏上的硬件外挂，允许让玩家拥有无限的血量，在游戏内达到“无敌”的层面。</p>
<p>使用方式通常是在主机与游戏卡带之间插入金手指硬件，并在启动游戏前或运行过程中输入对应的作弊码。作弊码配置完成后，金手指会在游戏运行时自动生效，无需修改游戏程序或重新加载数据。</p>
<h3 id="原理">原理</h3>
<p>其作为插在主机 CPU 与游戏卡带之间的硬件中间层，通过直接监听并拦截地址总线与数据总线，在 CPU 访问特定内存地址或指令地址时，动态替换返回的数据或指令。它并不修改游戏卡带中的 ROM 或 RAM 芯片本身，而是在总线级别对内存访问结果进行实时篡改，使 CPU 在执行过程中获得被伪造的内存状态或指令流，从而改变游戏逻辑。</p>
<p>在缺乏虚拟内存与权限隔离的早期游戏主机环境中，这种总线级拦截可以对程序执行产生完全透明且即时的影响。</p>
<h3 id="作弊码">作弊码</h3>
<p>所谓“作弊码”并非密码或魔法字符串，而是对目标地址、替换数据以及可选条件的编码表示。用户输入的字符序列在金手指内部被解码为一组地址匹配与数据替换规则，当 CPU 在运行过程中访问这些地址时，金手指根据规则判断是否命中，并在命中时返回预先设定的替换数据。</p>
<p>例如解码作弊码后可以得到以下类似的数据</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">cheat_rule</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">uint16_t</span> address<span class="token punctuation">;</span>     <span class="token comment">// 目标地址</span>
    <span class="token class-name">uint8_t</span>  new_value<span class="token punctuation">;</span>   <span class="token comment">// 替换的数据</span>
    <span class="token class-name">uint8_t</span>  compare<span class="token punctuation">;</span>     <span class="token comment">// 可选：原值匹配</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后根据定义的逻辑数据，将血量地址改为999999,这样的话，当游戏机想要读取血量地址的数据，就会被金手指意识到后拦截卡带中的原血量，返回999999。</p>
<h2 id="入侵内存修改">入侵内存修改</h2>
<p>由于是早期游戏，许多例如血量设计，都是静态的存储，血量数据的地址的固定的。现在的内存通常是类似于以下</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">player <span class="token operator">=</span> new <span class="token function">Player</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>动态内存的方式创建的。因此就无法像作弊码一样输入固定的address了。</p>
<p>对于像Cheat Engine这些修改器他们的做法就是：</p>
<p>类似以下</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_GNU_SOURCE</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAX_ADDRS</span> <span class="token expression"><span class="token number">10000000</span>   </span><span class="token comment">// 最多保存 1e7 个候选地址</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LINE_LEN</span> <span class="token expression"><span class="token number">512</span></span></span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">uintptr_t</span> start<span class="token punctuation">;</span>
    <span class="token class-name">uintptr_t</span> end<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token class-name">region_t</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token class-name">uintptr_t</span> <span class="token operator">*</span>candidates<span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token class-name">size_t</span> cand_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">/* 解析 /proc/pid/maps，只保留可读的匿名/heap 区域 */</span>
<span class="token class-name">size_t</span> <span class="token function">load_regions</span><span class="token punctuation">(</span><span class="token class-name">pid_t</span> pid<span class="token punctuation">,</span> <span class="token class-name">region_t</span> <span class="token operator">*</span><span class="token operator">*</span>out<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">char</span> path<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">snprintf</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/proc/%d/maps"</span><span class="token punctuation">,</span> pid<span class="token punctuation">)</span><span class="token punctuation">;</span>

    FILE <span class="token operator">*</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen maps"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token class-name">size_t</span> cap <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">region_t</span> <span class="token operator">*</span>regs <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>cap <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">region_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> line<span class="token punctuation">[</span>LINE_LEN<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">fgets</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">uintptr_t</span> start<span class="token punctuation">,</span> end<span class="token punctuation">;</span>
        <span class="token keyword">char</span> perm<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rest<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token function">sscanf</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> <span class="token string">"%lx-%lx %4s %*s %*s %*s %255[^\\n]"</span><span class="token punctuation">,</span>
               <span class="token operator">&amp;</span>start<span class="token punctuation">,</span> <span class="token operator">&amp;</span>end<span class="token punctuation">,</span> perm<span class="token punctuation">,</span> rest<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>perm<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token char">'r'</span><span class="token punctuation">)</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>

        <span class="token comment">/* 只扫 heap 或匿名映射，避免代码段/文件段 */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span>rest<span class="token punctuation">,</span> <span class="token string">"[heap]"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">strlen</span><span class="token punctuation">(</span>rest<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> cap<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                cap <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                regs <span class="token operator">=</span> <span class="token function">realloc</span><span class="token punctuation">(</span>regs<span class="token punctuation">,</span> cap <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">region_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            regs<span class="token punctuation">[</span>n<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">region_t</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> start<span class="token punctuation">,</span> end <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>out <span class="token operator">=</span> regs<span class="token punctuation">;</span>
    <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/* 初次扫描 */</span>
<span class="token keyword">void</span> <span class="token function">initial_scan</span><span class="token punctuation">(</span><span class="token keyword">int</span> memfd<span class="token punctuation">,</span> <span class="token class-name">region_t</span> <span class="token operator">*</span>regs<span class="token punctuation">,</span> <span class="token class-name">size_t</span> nregs<span class="token punctuation">,</span> <span class="token keyword">int</span> target<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    cand_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nregs<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">uintptr_t</span> addr <span class="token operator">=</span> regs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>start<span class="token punctuation">;</span>
             addr <span class="token operator">+</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> regs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>end<span class="token punctuation">;</span>
             addr <span class="token operator">+=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

            <span class="token keyword">int</span> v<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pread</span><span class="token punctuation">(</span>memfd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> addr<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">==</span> target<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                candidates<span class="token punctuation">[</span>cand_count<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> addr<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>cand_count <span class="token operator">>=</span> MAX_ADDRS<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Too many candidates, abort.\\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/* 多次筛选 */</span>
<span class="token keyword">void</span> <span class="token function">filter_scan</span><span class="token punctuation">(</span><span class="token keyword">int</span> memfd<span class="token punctuation">,</span> <span class="token keyword">int</span> target<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">size_t</span> w <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cand_count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> v<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pread</span><span class="token punctuation">(</span>memfd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> candidates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">==</span> target<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            candidates<span class="token punctuation">[</span>w<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> candidates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    cand_count <span class="token operator">=</span> w<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/* 批量写回 */</span>
<span class="token keyword">void</span> <span class="token function">patch_all</span><span class="token punctuation">(</span><span class="token keyword">int</span> memfd<span class="token punctuation">,</span> <span class="token keyword">int</span> newval<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cand_count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">pwrite</span><span class="token punctuation">(</span>memfd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>newval<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>newval<span class="token punctuation">)</span><span class="token punctuation">,</span> candidates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"usage: %s &lt;pid>\\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token class-name">pid_t</span> pid <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> mempath<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">snprintf</span><span class="token punctuation">(</span>mempath<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>mempath<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/proc/%d/mem"</span><span class="token punctuation">,</span> pid<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> memfd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>mempath<span class="token punctuation">,</span> O_RDWR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>memfd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"open mem"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token class-name">region_t</span> <span class="token operator">*</span>regions<span class="token punctuation">;</span>
    <span class="token class-name">size_t</span> nregs <span class="token operator">=</span> <span class="token function">load_regions</span><span class="token punctuation">(</span>pid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>regions<span class="token punctuation">)</span><span class="token punctuation">;</span>

    candidates <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>MAX_ADDRS <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">uintptr_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>candidates<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"malloc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">int</span> v<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Initial value: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">initial_scan</span><span class="token punctuation">(</span>memfd<span class="token punctuation">,</span> regions<span class="token punctuation">,</span> nregs<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Found %zu candidates\\n"</span><span class="token punctuation">,</span> cand_count<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span>cand_count <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Next value (or -1 to stop): "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token function">filter_scan</span><span class="token punctuation">(</span>memfd<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Remaining %zu candidates\\n"</span><span class="token punctuation">,</span> cand_count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>cand_count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"No candidates left.\\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"New value to write: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">patch_all</span><span class="token punctuation">(</span>memfd<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Patched %zu addresses.\\n"</span><span class="token punctuation">,</span> cand_count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>通过扫描游戏内的一个值例如金钱 10000 ，会有许多个10000的值的地址</p>
<p>然后花费金钱到9000，再扫描上述地址中谁变成9000</p>
<p>然后变化金钱，再次扫描，直到确定是哪些地址。</p>
<p>修改这些地址中的值，金钱也就会直接被变化。</p>
<h2 id="修改内存的三种方法">修改内存的三种方法</h2>
<h3 id="通过-proc-pid-mem-直接读写内存（最直观）">通过 <code>/proc/&lt;pid&gt;/mem</code> 直接读写内存（最直观）</h3>
<p>Linux 为每个进程提供了一个特殊文件 <code>/proc/&lt;pid&gt;/mem</code>，它是目标进程虚拟地址空间的线性视图。只要具备权限，用户程序就可以通过 <code>pread / pwrite</code>，在指定虚拟地址处直接读取或修改目标进程的内存内容。</p>
<h3 id="使用-ptrace-控制并修改进程（最“调试器式”）">使用 <code>ptrace</code> 控制并修改进程（最“调试器式”）</h3>
<p><code>ptrace</code> 是 Linux 提供的进程调试接口，允许一个进程附加（attach）到另一个进程，并完全控制其执行状态。调试进程可以：</p>
<ul>
<li>暂停目标进程</li>
<li>读写其寄存器</li>
<li>读写其内存</li>
<li>单步执行</li>
</ul>
<h3 id="使用-process-vm-readv-writev（最“现代”、最高效）">使用 <code>process_vm_readv / writev</code>（最“现代”、最高效）</h3>
<p>这是 Linux 3.2 引入的系统调用，允许一个进程在获得权限的前提下，直接在内核中完成进程间内存拷贝，绕过 <code>/proc</code> 文件接口。</p>
<h3 id="三种方式的横向对比">三种方式的横向对比</h3>
<table>
<thead>
<tr>
<th>方式</th>
<th>控制粒度</th>
<th>性能</th>
<th>易理解</th>
<th>典型角色</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/proc/pid/mem</code></td>
<td>内存级</td>
<td>中</td>
<td>高</td>
<td>CE、教学</td>
</tr>
<tr>
<td><code>ptrace</code></td>
<td>执行 + 内存</td>
<td>低</td>
<td>中</td>
<td>GDB</td>
</tr>
<tr>
<td><code>process_vm_*</code></td>
<td>内存级</td>
<td>高</td>
<td>低</td>
<td>专业工具</td>
</tr>
</tbody>
</table>

        </article>
        <section class="post-near">
            <ul>
                
                    <li>上一篇: <a href="/2025/12/30/MiniOB-note-sql/">MiniOB 项目结构——SQL板块</a></li>
                
                
                    <li>下一篇: <a href="/2025/12/18/OS-%E7%A8%8B%E5%BA%8F%E4%B8%8E%E8%BF%9B%E7%A8%8B&amp;%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86API/">操作系统笔记——程序与进程&amp;进程管理API</a></li>
                
            </ul>
        </section>
        
            <section class="post-tags">
            <a class="-none-link" href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag">操作系统</a>
            </section>
        
    
        <section class="post-author">
        
            <figure class="author-avatar">
                <img src="https://avatars.githubusercontent.com/u/62082723" alt="Mai Icy" />
            </figure>
        
            <div class="author-info">
                <h4>Mai Icy</h4>
                <p>wwwwwww</p>
            </div>
        </section>
    
    </div>
</main>

    <footer>
    <div class="buttons">
        <a class="to-top" href="#"></a>
    </div>
    <div class="wrap min">
        <section class="widget">
            <div class="row">
                <div class="col-m-4">
                    <h3 class="title-recent">最新文章：</h3>
                    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2026/01/15/OS-%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/">操作系统笔记——进程管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2026/01/10/OS-%E8%AE%BE%E5%A4%87%E7%AE%A1%E7%90%86/">操作系统笔记——设备管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2026/01/05/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0/">操作系统笔记——操作系统概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/12/30/MiniOB-note-sql/">MiniOB 项目结构——SQL板块</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/12/23/OS-mmap%E5%92%8C%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4/">操作系统笔记——mmap 和进程的地址空间</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/12/18/OS-%E7%A8%8B%E5%BA%8F%E4%B8%8E%E8%BF%9B%E7%A8%8B&%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86API/">操作系统笔记——程序与进程&进程管理API</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-date">时光机：</h3>
                    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2026/01/">January 2026</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/12/">December 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/11/">November 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/10/">October 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/08/">August 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/06/">June 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/04/">April 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/03/">March 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/02/">February 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/01/">January 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">December 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">June 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">September 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-tags">标签云：</h3>
                    <a href="/tags/2-SAT/" style="font-size: 10px;">2-SAT</a> <a href="/tags/3D-3D-ICP/" style="font-size: 10px;">3D-3D:ICP</a> <a href="/tags/AC%E8%87%AA%E5%8A%A8%E6%9C%BA/" style="font-size: 10px;">AC自动机</a> <a href="/tags/ARISE%E4%BC%98%E5%8C%96/" style="font-size: 10px;">ARISE优化</a> <a href="/tags/B-%E6%A0%91/" style="font-size: 10px;">B+树</a> <a href="/tags/BitTorrent/" style="font-size: 10px;">BitTorrent</a> <a href="/tags/C/" style="font-size: 11.43px;">C</a> <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/CDQ%E5%88%86%E6%B2%BB/" style="font-size: 10px;">CDQ分治</a> <a href="/tags/DNS/" style="font-size: 11.43px;">DNS</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/HTTP%E6%B5%81/" style="font-size: 10px;">HTTP流</a> <a href="/tags/KMP/" style="font-size: 10px;">KMP</a> <a href="/tags/KNN/" style="font-size: 10px;">KNN</a> <a href="/tags/LDA/" style="font-size: 10px;">LDA</a> <a href="/tags/LLE/" style="font-size: 10px;">LLE</a> <a href="/tags/LSA/" style="font-size: 10px;">LSA</a> <a href="/tags/LSM%E6%A0%91/" style="font-size: 10px;">LSM树</a> <a href="/tags/LightHouse/" style="font-size: 10px;">LightHouse</a> <a href="/tags/Linux/" style="font-size: 11.43px;">Linux</a> <a href="/tags/MCP/" style="font-size: 10px;">MCP</a> <a href="/tags/Manacher%E7%AE%97%E6%B3%95/" style="font-size: 10px;">Manacher算法</a> <a href="/tags/MiniOB/" style="font-size: 10px;">MiniOB</a> <a href="/tags/NMF/" style="font-size: 10px;">NMF</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/OAuth2-0/" style="font-size: 11.43px;">OAuth2.0</a> <a href="/tags/P2P/" style="font-size: 10px;">P2P</a> <a href="/tags/PCA/" style="font-size: 10px;">PCA</a> <a href="/tags/Qwen/" style="font-size: 10px;">Qwen</a> <a href="/tags/RAG/" style="font-size: 11.43px;">RAG</a> <a href="/tags/RDT/" style="font-size: 10px;">RDT</a> <a href="/tags/SLAM/" style="font-size: 10px;">SLAM</a> <a href="/tags/SMTP-POP3-IMAP/" style="font-size: 10px;">SMTP/POP3/IMAP</a> <a href="/tags/ST%E8%A1%A8/" style="font-size: 10px;">ST表</a> <a href="/tags/Spring/" style="font-size: 11.43px;">Spring</a> <a href="/tags/Spring-Boot/" style="font-size: 12.86px;">Spring Boot</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/UDP/" style="font-size: 10px;">UDP</a> <a href="/tags/WebDAV/" style="font-size: 10px;">WebDAV</a> <a href="/tags/diesel/" style="font-size: 10px;">diesel</a> <a href="/tags/epoll/" style="font-size: 10px;">epoll</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/io%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/" style="font-size: 10px;">io多路复用</a> <a href="/tags/java/" style="font-size: 17.14px;">java</a> <a href="/tags/k-means/" style="font-size: 10px;">k-means</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/python/" style="font-size: 14.29px;">python</a> <a href="/tags/redo-undo%E6%97%A5%E5%BF%97/" style="font-size: 10px;">redo/undo日志</a> <a href="/tags/requests/" style="font-size: 11.43px;">requests</a> <a href="/tags/t-SNE/" style="font-size: 10px;">t-SNE</a> <a href="/tags/tarjan/" style="font-size: 10px;">tarjan</a> <a href="/tags/web%E7%BC%93%E5%AD%98/" style="font-size: 10px;">web缓存</a> <a href="/tags/%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86/" style="font-size: 10px;">中国剩余定理</a> <a href="/tags/%E4%B9%90%E8%A7%82%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/" style="font-size: 10px;">乐观并发控制</a> <a href="/tags/%E4%BA%8B%E5%8A%A1/" style="font-size: 10px;">事务</a> <a href="/tags/%E4%BA%8C%E5%88%86%E5%9B%BE%E5%8C%B9%E9%85%8D/" style="font-size: 10px;">二分图匹配</a> <a href="/tags/%E4%BA%8C%E5%88%86%E7%AD%94%E6%A1%88/" style="font-size: 10px;">二分答案</a> <a href="/tags/%E4%BC%A0%E8%BE%93%E5%B1%82/" style="font-size: 10px;">传输层</a> <a href="/tags/%E4%BD%8D%E5%9B%BE%E7%B4%A2%E5%BC%95/" style="font-size: 10px;">位图索引</a> <a href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" style="font-size: 11.43px;">动态规划</a> <a href="/tags/%E5%8D%8F%E8%AE%AE%E5%88%86%E5%B1%82/" style="font-size: 10px;">协议分层</a> <a href="/tags/%E5%8F%8C%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/" style="font-size: 10px;">双连通分量</a> <a href="/tags/%E5%90%8C%E4%BD%99/" style="font-size: 10px;">同余</a> <a href="/tags/%E5%90%8C%E4%BD%99%E9%80%86%E5%85%83/" style="font-size: 10px;">同余逆元</a> <a href="/tags/%E5%90%8E%E7%BC%80SA/" style="font-size: 10px;">后缀SA</a> <a href="/tags/%E5%93%88%E5%B8%8C%E7%B4%A2%E5%BC%95/" style="font-size: 10px;">哈希索引</a> <a href="/tags/%E5%9B%BE%E7%AE%97%E6%B3%95/" style="font-size: 14.29px;">图算法</a> <a href="/tags/%E5%9B%BE%E8%AE%BA/" style="font-size: 14.29px;">图论</a> <a href="/tags/%E5%9F%BA%E7%8E%AF%E6%A0%91/" style="font-size: 10px;">基环树</a> <a href="/tags/%E5%A4%9A%E7%89%88%E6%9C%AC%E6%9C%BA%E5%88%B6/" style="font-size: 10px;">多版本机制</a> <a href="/tags/%E5%A4%9A%E7%BB%B4%E7%B4%A2%E5%BC%95/" style="font-size: 10px;">多维索引</a> <a href="/tags/%E5%A4%9A%E8%B7%AF%E5%88%86%E8%A7%A3/" style="font-size: 10px;">多路分解</a> <a href="/tags/%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/" style="font-size: 10px;">多路复用</a> <a href="/tags/%E5%AD%97%E5%85%B8%E6%A0%91/" style="font-size: 10px;">字典树</a> <a href="/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/" style="font-size: 10px;">字符串</a> <a href="/tags/%E5%AE%B9%E6%96%A5%E5%8E%9F%E7%90%86/" style="font-size: 10px;">容斥原理</a> <a href="/tags/%E5%B7%AE%E5%88%86%E7%BA%A6%E6%9D%9F/" style="font-size: 10px;">差分约束</a> <a href="/tags/%E5%BA%B7%E6%89%98%E5%B1%95%E5%BC%80/" style="font-size: 10px;">康托展开</a> <a href="/tags/%E5%BC%82%E6%88%96%E5%93%88%E5%B8%8C/" style="font-size: 10px;">异或哈希</a> <a href="/tags/%E5%BC%82%E6%AD%A5/" style="font-size: 10px;">异步</a> <a href="/tags/%E5%BC%BA%E8%81%94%E9%80%9A%E5%88%86%E9%87%8F/" style="font-size: 11.43px;">强联通分量</a> <a href="/tags/%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2FFT/" style="font-size: 10px;">快速傅里叶变换FFT</a> <a href="/tags/%E5%BF%AB%E9%80%9F%E5%B9%82/" style="font-size: 10px;">快速幂</a> <a href="/tags/%E6%82%B2%E8%A7%82%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/" style="font-size: 10px;">悲观并发控制</a> <a href="/tags/%E6%8E%A5%E5%85%A5%E6%8A%80%E6%9C%AF/" style="font-size: 10px;">接入技术</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 17.14px;">操作系统</a> <a href="/tags/%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA/" style="font-size: 10px;">支持向量机</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 17.14px;">数据库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%98%E5%82%A8/" style="font-size: 10px;">数据库存储</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E9%AA%8C/" style="font-size: 15.71px;">数据库实验</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 10px;">数据结构</a> <a href="/tags/%E6%95%B0%E8%AE%BA/" style="font-size: 10px;">数论</a> <a href="/tags/%E6%97%B6%E9%97%B4%E6%88%B3%E6%8E%92%E5%BA%8F%E6%9C%BA%E5%88%B6/" style="font-size: 10px;">时间戳排序机制</a> <a href="/tags/%E6%9C%80%E5%A4%A7%E6%B5%81/" style="font-size: 10px;">最大流</a> <a href="/tags/%E6%9C%80%E5%B0%8F%E5%89%B2/" style="font-size: 10px;">最小割</a> <a href="/tags/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/" style="font-size: 10px;">最短路径</a> <a href="/tags/%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF/" style="font-size: 10px;">朴素贝叶斯</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 17.14px;">机器学习</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%A6%82%E8%A6%81/" style="font-size: 10px;">机器学习概要</a> <a href="/tags/%E6%9E%81%E8%A7%92%E6%8E%92%E5%BA%8F/" style="font-size: 10px;">极角排序</a> <a href="/tags/%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/" style="font-size: 10px;">查询优化</a> <a href="/tags/%E6%9F%A5%E8%AF%A2%E5%A4%84%E7%90%86/" style="font-size: 10px;">查询处理</a> <a href="/tags/%E6%9F%A5%E8%AF%A2%E6%89%A7%E8%A1%8C/" style="font-size: 10px;">查询执行</a> <a href="/tags/%E6%A0%91%E4%B8%8A%E5%90%AF%E5%8F%91%E5%BC%8F%E5%90%88%E5%B9%B6/" style="font-size: 10px;">树上启发式合并</a> <a href="/tags/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84/" style="font-size: 10px;">树状数组</a> <a href="/tags/%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86/" style="font-size: 10px;">树链剖分</a> <a href="/tags/%E6%A0%B9%E5%8F%B7%E5%88%86%E6%B2%BB/" style="font-size: 10px;">根号分治</a> <a href="/tags/%E6%AD%A3%E5%88%99%E5%8C%96/" style="font-size: 10px;">正则化</a> <a href="/tags/%E6%AF%8D%E5%87%BD%E6%95%B0/" style="font-size: 10px;">母函数</a> <a href="/tags/%E6%B7%B7%E5%90%88%E9%AB%98%E6%96%AF%E5%88%86%E5%B8%83/" style="font-size: 10px;">混合高斯分布</a> <a href="/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/" style="font-size: 11.43px;">源码阅读</a> <a href="/tags/%E7%8A%B6%E6%80%81%E5%8E%8B%E7%BC%A9/" style="font-size: 10px;">状态压缩</a> <a href="/tags/%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6/" style="font-size: 10px;">电子邮件</a> <a href="/tags/%E7%9F%A9%E9%98%B5/" style="font-size: 10px;">矩阵</a> <a href="/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">神经网络</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 20px;">算法</a> <a href="/tags/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/" style="font-size: 10px;">线性回归</a> <a href="/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/" style="font-size: 10px;">线段树</a> <a href="/tags/%E7%BB%84%E5%90%88%E5%8D%9A%E5%BC%88/" style="font-size: 10px;">组合博弈</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">网络</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%B1%82/" style="font-size: 10px;">网络层</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/" style="font-size: 12.86px;">网络流</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/" style="font-size: 10px;">网络爬虫</a> <a href="/tags/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/" style="font-size: 10px;">背包问题</a> <a href="/tags/%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF%E5%8F%8D%E6%BC%94/" style="font-size: 10px;">莫比乌斯反演</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95/" style="font-size: 10px;">计算几何</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 18.57px;">计算机网络</a> <a href="/tags/%E8%B4%AA%E5%BF%83/" style="font-size: 10px;">贪心</a> <a href="/tags/%E8%B4%B9%E7%94%A8%E6%B5%81/" style="font-size: 10px;">费用流</a> <a href="/tags/%E9%80%92%E6%8E%A8/" style="font-size: 10px;">递推</a> <a href="/tags/%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/" style="font-size: 10px;">逻辑回归</a> <a href="/tags/%E9%93%BE%E8%B7%AF%E5%B1%82/" style="font-size: 10px;">链路层</a> <a href="/tags/%E9%94%81%E6%9C%BA%E5%88%B6/" style="font-size: 10px;">锁机制</a> <a href="/tags/%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97/" style="font-size: 10px;">随机森林</a>
                </div>
            </div>
        </section>
        <section class="sub-footer">
            <p>© 2026 <a href="/">Mai Icy</a>. All Rights Reserved. Theme By <a href="https://github.com/Dreamer-Paul/Hingle" target="_blank" rel="nofollow">Hingle</a>.</p>
        </section>
    </div>
</footer>


<script src="/static/kico.js"></script>
<script src="/static/hingle.js"></script>


<script>var hingle = new Paul_Hingle({"copyright":true,"night":true});</script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
